<!-- templates/procurement/suppliers/list.html -->
<!DOCTYPE html>
<html lang="vi"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/main}">
<head>
    <meta charset="UTF-8" />
    <title>Suppliers</title>

    <!-- Inter (nếu layout đã nạp sẵn có thể bỏ) -->
<!--    <link rel="preconnect" href="https://fonts.googleapis.com">-->
<!--    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>-->
<!--    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">-->

    <style>
        :root{
            --app-font:"Inter",system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif;
            --bg:#f8fafc; --surface:#fff; --text:#0f172a; --muted:#64748b; --bd:#e2e8f0;
            --primary:#2563eb; --primary-hover:#1d4ed8;
            --success:#22c55e; --warning:#fbbf24; --danger:#ef4444; --danger-hover:#dc2626;
        }
        html,body,.topbar,.topbar *,.sidebar,.sidebar *{ font-family:var(--app-font) !important; }
        body{ color:var(--text); background:var(--bg); }

        .wrap{ max-width:1100px; margin:0 auto; padding:32px 0; }

        .page-title{
            font-size:1.75rem; font-weight:800; line-height:1.2; letter-spacing:-0.01em;
            text-align:center; margin:0 0 18px;
        }

        /* Toolbar */
        .toolbar{
            display:flex; align-items:center; justify-content:space-between;
            gap:12px; flex-wrap:wrap; margin-bottom:14px;
        }
        .search-form{ display:flex; gap:8px; align-items:center; }
        .form-control{
            width:260px; max-width:60vw; padding:.65rem .9rem; border:1px solid var(--bd); border-radius:.75rem;
            background:var(--surface); font-size:.95rem; color:var(--text); transition:.18s;
        }
        .form-control:focus{ outline:none; border-color:var(--primary); box-shadow:0 0 0 3px #93c5fd; }

        .btn{
            display:inline-flex; align-items:center; justify-content:center; height:36px; min-width:90px;
            border-radius:.55rem; border:1px solid transparent; font-weight:700; font-size:.85rem; padding:0 .9rem;
            cursor:pointer; transition:.15s;
        }
        .btn-primary{ background:var(--primary); color:#fff; } .btn-primary:hover{ background:var(--primary-hover); }
        .btn-success{ background:var(--success); color:#fff; }
        .btn-warning{ background:var(--warning); color:#111827; border:none; }
        .btn-danger{ background:var(--danger); color:#fff; border:none; } .btn-danger:hover{ background:var(--danger-hover); }

        /* Table card */
        .table-card{ background:var(--surface); border:1px solid var(--bd); border-radius:1rem; box-shadow:0 2px 4px rgba(15,23,42,.06); overflow:hidden; }
        .table-responsive{ overflow:auto; border-radius:1rem; }
        table{ width:100%; border-collapse:separate; border-spacing:0; font-size:.95rem; }
        thead th{
            position:sticky; top:0; z-index:1; background:#eef2f7; color:#0f172a; border-bottom:1px solid var(--bd);
            text-transform:uppercase; font-weight:800; font-size:.8rem; letter-spacing:.02em;
            padding:.75rem .9rem; text-align:center;
        }
        tbody td{ padding:.9rem .9rem; border-bottom:1px solid var(--bd); background:#fff; text-align:center; vertical-align:middle; }
        tbody tr:hover td{ background:#f8fafc; }

        /* Pagination pills (dùng component chung) */
        .pagination{ display:flex; gap:.5rem; align-items:center; margin-top:16px; }
        .page-item{ list-style:none; }
        .page-link{
            display:inline-flex; align-items:center; justify-content:center; min-width:40px; height:36px; padding:0 .75rem;
            border-radius:10px; border:1px solid #e2e8f0; background:#fff; color:#0f172a; font-weight:700; text-decoration:none;
            transition:background .15s, border-color .15s, color .15s;
        }
        .page-item.active .page-link{ background:#16a34a; color:#fff; border-color:#16a34a; }
        .page-item.disabled .page-link{ background:#f1f5f9; color:#94a3b8; border-color:#e2e8f0; pointer-events:none; }
        .page-link:hover{ background:#f8fafc; }
    </style>
</head>
<body>
<section layout:fragment="content">

    <!-- Khi KHÔNG có quyền VIEW -->
    <div class="alert alert-warning" sec:authorize="!hasAnyAuthority('SUPPLIER_VIEW','ROLE_ADMIN')">
        Bạn không có quyền xem danh sách nhà cung cấp.
    </div>

    <!-- Khi CÓ quyền VIEW -->
    <div sec:authorize="hasAnyAuthority('SUPPLIER_VIEW','ROLE_ADMIN')" class="wrap">

        <h1 class="page-title">Danh sách nhà cung cấp</h1>

        <div class="toolbar">
            <form method="get" th:action="@{/admin/procurement/suppliers}" class="search-form">
                <input class="form-control" type="text" name="q" th:value="${q}" placeholder="Search name/email/phone">
                <button class="btn btn-primary" type="submit">Search</button>
            </form>

            <!-- Nút thêm chỉ hiển thị khi có quyền CREATE -->
            <a th:href="@{/admin/procurement/suppliers/new}"
               class="btn btn-success"
               sec:authorize="hasAnyAuthority('SUPPLIER_CREATE','ROLE_ADMIN')">Thêm nhà cung cấp</a>
        </div>

        <div class="table-card">
            <div class="table-responsive">
                <table class="table table-striped table-hover">
                    <thead class="table-light">
                    <tr>
                        <th>ID</th>
                        <th>Tên Nhà cung cấp</th>
                        <th>Email</th>
                        <th>SĐT</th>
                        <th>Địa chỉ</th>
                        <th>Thao tác</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="s : ${page?.content}">
                        <td th:text="${s.id}">1</td>
                        <td th:text="${s.name}">ABC</td>
                        <td th:text="${s.email}">a@b.com</td>
                        <td th:text="${s.phone}">0123</td>
                        <td th:text="${s.address}">HN</td>
                        <td class="d-flex gap-2" style="display:flex; gap:8px; justify-content:center;">
                            <!-- Edit chỉ hiển thị khi có quyền EDIT -->
                            <a th:href="@{|/admin/procurement/suppliers/${s.id}/edit|}"
                               class="btn btn-warning btn-sm"
                               sec:authorize="hasAnyAuthority('SUPPLIER_EDIT','ROLE_ADMIN')">Edit</a>

                            <!-- Delete chỉ hiển thị khi có quyền DELETE -->
                            <a th:href="@{|/admin/procurement/suppliers/${s.id}/delete|}"
                               class="btn btn-danger btn-sm"
                               onclick="return confirm('Xóa?')"
                               sec:authorize="hasAnyAuthority('SUPPLIER_DELETE','ROLE_ADMIN')">Delete</a>
                        </td>
                    </tr>

                    <tr th:if="${page == null || #lists.isEmpty(page.content)}">
                        <td colspan="6" class="text-center" style="padding:18px; color:var(--muted);">No data</td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Phân trang pills dùng component chung, giữ tham số q -->
        <div th:replace="~{layout/components/_pagination :: body(
            page=${page},
            baseUrl='/admin/procurement/suppliers',
            q=${q}
    )}"></div>

    </div>
</section>
</body>
</html>
