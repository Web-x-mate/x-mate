<!DOCTYPE html>
<html lang="vi"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/main}">
<head>
    <meta charset="UTF-8">
    <title>Khách hàng</title>

    <!-- CSS riêng của trang (nếu có) -->
    <!--<link rel="stylesheet" th:href="@{/css/customers/customer/list.css}">-->

    <!-- Ghi đè font để đồng bộ với các trang Orders/Products/Discounts -->
    <style>
        :root{
            --app-font: "Inter", system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
            --bg:#f8fafc; --surface:#fff; --text:#0f172a; --muted:#64748b; --bd:#e2e8f0;
            --primary:#2563eb; --primary-hover:#1d4ed8;
            --success:#22c55e; --danger:#ef4444; --danger-hover:#dc2626;
        }

        body, .sidebar, .sidebar *, .topbar, .topbar * {
            font-family: var(--app-font) !important;
        }

        body{color:var(--text);background:var(--bg);}
        .wrap{max-width:1100px;margin:0 auto;padding:32px 0;}
        .page-title{font-size:1.9rem;font-weight:800;text-align:center;margin:0 0 18px;}

        /* Toolbar */
        .toolbar{display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap;margin-bottom:14px;}
        .search-form{display:flex;gap:8px;align-items:center;}
        .input{
            width:280px;max-width:60vw;padding:.65rem .9rem;border:1px solid var(--bd);border-radius:.75rem;
            background:#fff;font-size:.95rem;color:var(--text);transition:.18s;
        }
        .input:focus{outline:none;border-color:var(--primary);box-shadow:0 0 0 3px #93c5fd;}

        /* Buttons */
        .btn{
            display:inline-flex;align-items:center;justify-content:center;height:36px;min-width:90px;
            border-radius:.55rem;border:1px solid transparent;font-weight:700;font-size:.85rem;padding:0 .9rem;cursor:pointer;transition:.15s;
        }
        .btn-primary{background:var(--primary);color:#fff;} .btn-primary:hover{background:var(--primary-hover);}
        .btn-success{background:var(--success);color:#fff;}
        .btn-warning{background:#fbbf24;color:#111827;border:none;}
        .btn-danger{background:var(--danger);color:#fff;border:none;} .btn-danger:hover{background:var(--danger-hover);}
        .btn-light{background:#f1f5f9;color:#0f172a;border:1px solid var(--bd);}

        /* Table card */
        .table-card{background:var(--surface);border:1px solid var(--bd);border-radius:1rem;box-shadow:0 2px 4px rgba(15,23,42,.06);overflow:hidden;}
        .overflow-x-auto{overflow-x:auto;}
        table{width:100%;border-collapse:separate;border-spacing:0;font-size:.95rem;}
        thead th{
            position:sticky;top:0;z-index:1;background:#eef2f7;color:#0f172a;border-bottom:1px solid var(--bd);
            text-transform:uppercase;font-weight:800;font-size:.8rem;letter-spacing:.02em;
            padding:.75rem .9rem;text-align:center;
        }
        tbody td{padding:.9rem .9rem;border-bottom:1px solid var(--bd);background:#fff;text-align:center;vertical-align:middle;}
        tbody tr:hover td{background:#f8fafc;}

        /* Badge */
        .badge{display:inline-flex;align-items:center;justify-content:center;border-radius:.6rem;padding:.35rem .6rem;font-weight:800;font-size:.72rem;color:#fff;}
        .badge-success{background:var(--success);}
        .badge-danger{background:var(--danger);}

        .truncate{max-width:240px;display:inline-block;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;vertical-align:bottom;}

        /* Pagination pills */
        .pagination{display:flex;gap:.5rem;align-items:center;margin-top:16px;}
        .page-item{list-style:none;}
        .page-link{
            display:inline-flex;align-items:center;justify-content:center;min-width:40px;height:36px;padding:0 .75rem;
            border-radius:10px;border:1px solid #e2e8f0;background:#fff;color:#0f172a;font-weight:700;text-decoration:none;
            transition:background .15s,border-color .15s,color .15s;
        }
        .page-item.active .page-link{background:#16a34a;color:#fff;border-color:#16a34a;}
        .page-item.disabled .page-link{background:#f1f5f9;color:#94a3b8;border-color:#e2e8f0;pointer-events:none;}
        .page-link:hover{background:#f8fafc;}
        <style>
         .page-title{
             font-size: 1.75rem;
             font-weight: 800;
             line-height: 1.5;
             text-align: center;
             margin: 0 0 18px;
         }
    </style>

    </style>
</head>
<body>
<section layout:fragment="content" th:with="fmt='dd/MM/yyyy HH:mm'">

    <div class="alert alert-warning" sec:authorize="!hasAnyAuthority('CUSTOMER_VIEW','ROLE_ADMIN')">
        Bạn không có quyền xem danh sách khách hàng.
    </div>

    <div sec:authorize="hasAnyAuthority('CUSTOMER_VIEW','ROLE_ADMIN')" class="wrap">

        <h1 class="page-title">Danh sách khách hàng</h1>

        <!-- Toolbar -->
        <div class="toolbar">
            <form th:action="@{/admin/customers}" method="get" class="search-form">
                <input class="input" type="text" name="q" th:value="${q}" placeholder="Tìm theo email / họ tên">
                <button class="btn btn-primary" type="submit">Tìm</button>
            </form>

            <a class="btn btn-success"
               th:href="@{/admin/customers/new}"
               sec:authorize="hasAnyAuthority('CUSTOMER_CREATE','ROLE_ADMIN')">Tạo mới</a>
        </div>

        <!-- Messages -->
        <div class="alerts">
            <div th:if="${saved}" class="alert alert-success">Đã lưu!</div>
            <div th:if="${deleted}" class="alert alert-success">Đã xóa!</div>
            <div th:if="${error}" class="alert alert-danger" th:text="${error}"></div>
        </div>

        <!-- Table -->
        <div class="table-card">
            <div class="overflow-x-auto">
                <table class="table">
                    <thead>
                    <tr>
                        <th>ID</th>
                        <th>Họ tên</th>
                        <th>Email</th>
                        <th>Điện thoại</th>
                        <th>Giới tính</th>
                        <th>Enabled</th>
                        <th>Tạo lúc</th>
                        <th>Thao tác</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="c : ${ (page != null and page.content != null) ? page.content : items }">
                        <td th:text="${c.id}">1</td>
                        <td><span class="truncate" th:title="${c.fullname}" th:text="${c.fullname} ?: '-'">-</span></td>
                        <td><span class="truncate" th:title="${c.email}" th:text="${c.email}">-</span></td>
                        <td th:text="${c.phone} ?: '-'">-</td>
                        <td th:text="${c.gender} ?: '-'">-</td>
                        <td>
              <span class="badge"
                    th:text="${(c.enabled ?: false) ? 'Enabled' : 'Disabled'}"
                    th:classappend="${(c.enabled ?: false)} ? ' badge-success' : ' badge-danger'">Enabled</span>
                        </td>
                        <td th:text="${c.createdAt != null ? #temporals.format(c.createdAt, fmt) : '-'}">-</td>
                        <td style="display:flex;gap:8px;justify-content:center;flex-wrap:wrap;">
                            <a class="btn btn-warning btn-sm"
                               th:href="@{'/admin/customers/' + ${c.id} + '/edit'}"
                               sec:authorize="hasAnyAuthority('CUSTOMER_EDIT','ROLE_ADMIN')">Sửa</a>

                            <form th:action="@{'/admin/customers/' + ${c.id} + '/delete'}"
                                  method="post" style="display:inline"
                                  onsubmit="return confirm('Xóa khách hàng này?')"
                                  sec:authorize="hasAnyAuthority('CUSTOMER_DELETE','ROLE_ADMIN')">
                                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                                <button class="btn btn-danger btn-sm" type="submit">Xóa</button>
                            </form>
                        </td>
                    </tr>

                    <tr th:if="${(page == null || #lists.isEmpty(page.content)) and #lists.isEmpty(items)}">
                        <td colspan="8" class="text-center" style="padding:18px;color:var(--muted);">Không có dữ liệu</td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Pagination -->
        <div th:replace="~{layout/components/_pagination :: body(
            page=${page},
            baseUrl='/admin/customers',
            q=${q}
    )}"></div>

    </div>
</section>
</body>
</html>
