
<!--<!DOCTYPE html>-->
<!--<html lang="vi"-->
<!--      xmlns:th="http://www.thymeleaf.org"-->
<!--      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"-->
<!--      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"-->
<!--      layout:decorate="~{layout/main}">-->
<!--<head>-->
<!--    <meta charset="UTF-8">-->
<!--    <title>Khách hàng</title>-->
<!--    <style>-->
<!--        :root{-->
<!--            &#45;&#45;bg:#f8fafc;-->
<!--            &#45;&#45;surface:#ffffff;-->
<!--            &#45;&#45;text:#0f172a;-->
<!--            &#45;&#45;muted:#64748b;-->
<!--            &#45;&#45;bd:#e2e8f0;-->
<!--            &#45;&#45;ring:#93c5fd;-->
<!--            &#45;&#45;primary:#2563eb;-->
<!--            &#45;&#45;primary-hover:#1d4ed8;-->
<!--            &#45;&#45;success:#16a34a;-->
<!--            &#45;&#45;danger:#ef4444;-->
<!--        }-->

<!--        body{font-family:"Inter",system-ui,sans-serif;color:var(&#45;&#45;text);background:var(&#45;&#45;bg);}-->
<!--        .wrap{max-width:1100px;margin:0 auto;padding:32px 0;}-->

<!--        .page-title{font-size:1.9rem;font-weight:800;color:var(&#45;&#45;text);margin:0;}-->
<!--        .toolbar{display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap;margin-top:4px;}-->

<!--        /* Inputs & Buttons */-->
<!--        .input{-->
<!--            height:40px; min-width:280px;-->
<!--            padding:0 .9rem; border:1px solid var(&#45;&#45;bd); border-radius:12px;-->
<!--            background:#fff; color:var(&#45;&#45;text); font-size:.95rem; transition:.18s;-->
<!--        }-->
<!--        .input:focus{outline:none;border-color:var(&#45;&#45;primary);box-shadow:0 0 0 3px var(&#45;&#45;ring);}-->

<!--        .btn{-->
<!--            height:40px; padding:0 14px; border-radius:12px; border:1px solid transparent;-->
<!--            font-weight:700; font-size:.9rem; display:inline-flex; align-items:center; gap:.4rem;-->
<!--            color:#fff; background:var(&#45;&#45;primary); transition:.18s;-->
<!--        }-->
<!--        .btn:hover{background:var(&#45;&#45;primary-hover);}-->
<!--        .btn-primary{background:var(&#45;&#45;primary);}-->
<!--        .btn-light{background:#eef2f7;color:var(&#45;&#45;text);border:1px solid var(&#45;&#45;bd);}-->
<!--        .btn-light:hover{background:#e5eaf1;}-->
<!--        .btn-ghost{background:#fff;color:var(&#45;&#45;text);border:1px solid var(&#45;&#45;bd);}-->
<!--        .btn-ghost:hover{background:#f1f5f9;}-->
<!--        .btn-sm{height:34px;padding:0 12px;border-radius:10px;font-size:.82rem;}-->

<!--        /* Alerts giữ nguyên class, chỉ làm đẹp nhẹ */-->
<!--        .alert{border-radius:12px;padding:.8rem 1rem;margin:.5rem 0;font-weight:600;}-->
<!--        .alert-warning{background:#fff7ed;border:1px solid #fed7aa;color:#9a3412;}-->
<!--        .alert-success{background:#ecfdf5;border:1px solid #a7f3d0;color:#065f46;}-->
<!--        .alert-danger{background:#fef2f2;border:1px solid #fecaca;color:#991b1b;}-->

<!--        /* Card + Table */-->
<!--        .table-card{background:var(&#45;&#45;surface);border:1px solid var(&#45;&#45;bd);border-radius:16px;box-shadow:0 2px 4px rgba(15,23,42,.06);margin-top:16px;}-->
<!--        .overflow-x-auto{border-radius:16px;max-height:70vh;overflow:auto;}-->
<!--        .table{width:100%;border-collapse:separate;border-spacing:0;font-size:.95rem;}-->
<!--        thead th{-->
<!--            position:sticky;top:0;z-index:2;background:#eef2f7;color:#0f172a;border-bottom:1px solid var(&#45;&#45;bd);-->
<!--            text-transform:uppercase;font-weight:800;font-size:.78rem;letter-spacing:.02em;text-align:center;-->
<!--            padding:.75rem .95rem;white-space:nowrap;-->
<!--        }-->
<!--        tbody td{-->
<!--            padding:.75rem .95rem;border-bottom:1px solid var(&#45;&#45;bd);background:#fff;vertical-align:middle;text-align:center;-->
<!--        }-->
<!--        tbody tr:hover td{background:#f8fafc;}-->

<!--        thead th:first-child{border-top-left-radius:16px;}-->
<!--        thead th:last-child{border-top-right-radius:16px;}-->
<!--        tbody tr:last-child td:first-child{border-bottom-left-radius:16px;}-->
<!--        tbody tr:last-child td:last-child{border-bottom-right-radius:16px;}-->

<!--        .text-right{text-align:right;}-->
<!--        .truncate{display:inline-block;max-width:280px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;vertical-align:bottom;}-->

<!--        /* Badge Enabled/Disabled (giữ class cũ) */-->
<!--        .badge{display:inline-flex;align-items:center;gap:.3rem;font-weight:800;border-radius:.55rem;padding:.28rem .55rem;font-size:.78rem;line-height:1;}-->
<!--        .badge-success{background:var(&#45;&#45;success);color:#fff;}-->
<!--        .badge-danger{background:var(&#45;&#45;danger);color:#fff;}-->

<!--        /* Footer pager */-->
<!--        .pager{display:flex;align-items:center;gap:10px;margin-top:14px;}-->
<!--    </style>-->
<!--</head>-->
<!--<body>-->
<!--<section layout:fragment="content" th:with="fmt='dd/MM/yyyy HH:mm'">-->
<!--    &lt;!&ndash; Khi KHÔNG có quyền VIEW &ndash;&gt;-->
<!--    <div class="alert alert-warning" sec:authorize="!hasAnyAuthority('CUSTOMER_VIEW','ROLE_ADMIN')">-->
<!--        Bạn không có quyền xem danh sách khách hàng.-->
<!--    </div>-->

<!--    &lt;!&ndash; Khi CÓ quyền VIEW &ndash;&gt;-->
<!--    <div sec:authorize="hasAnyAuthority('CUSTOMER_VIEW','ROLE_ADMIN')" class="wrap">-->

<!--        <div class="toolbar">-->
<!--            <h1 class="page-title">Khách hàng</h1>-->

<!--            &lt;!&ndash; Nút tạo mới chỉ hiển thị khi có quyền CREATE &ndash;&gt;-->
<!--            <a class="btn btn-primary"-->
<!--               th:href="@{/admin/customers/new}"-->
<!--               sec:authorize="hasAnyAuthority('CUSTOMER_CREATE','ROLE_ADMIN')">Tạo mới</a>-->
<!--        </div>-->

<!--        &lt;!&ndash; Search &ndash;&gt;-->
<!--        <div class="mt-3">-->
<!--            <form th:action="@{/admin/customers}" method="get" class="flex gap-2" style="display:flex;gap:10px;align-items:center;flex-wrap:wrap;">-->
<!--                <input class="input" type="text" name="q" th:value="${q}" placeholder="Tìm theo email / họ tên"/>-->
<!--                <button class="btn" type="submit">Tìm</button>-->
<!--            </form>-->
<!--        </div>-->

<!--        &lt;!&ndash; Messages &ndash;&gt;-->
<!--        <div class="mt-3">-->
<!--            <div th:if="${saved}" class="alert alert-success">Đã lưu!</div>-->
<!--            <div th:if="${deleted}" class="alert alert-success">Đã xóa!</div>-->
<!--            <div th:if="${error}" class="alert alert-danger" th:text="${error}"></div>-->
<!--        </div>-->

<!--        &lt;!&ndash; Table &ndash;&gt;-->
<!--        <div class="table-card">-->
<!--            <div class="overflow-x-auto mt-3">-->
<!--                <table class="table">-->
<!--                    <thead>-->
<!--                    <tr>-->
<!--                        <th>ID</th>-->
<!--                        <th>Họ tên</th>-->
<!--                        <th>Email</th>-->
<!--                        <th>Điện thoại</th>-->
<!--                        <th>Giới tính</th>-->
<!--                        <th>Enabled</th>-->
<!--                        <th>Tạo lúc</th>-->
<!--                        <th></th>-->
<!--                    </tr>-->
<!--                    </thead>-->
<!--                    <tbody>-->
<!--                    <tr th:each="c : ${items}">-->
<!--                        <td th:text="${c.id}">1</td>-->
<!--                        <td class="col-left"><span class="truncate" th:title="${c.fullname}" th:text="${c.fullname} ?: '-'">-</span></td>-->
<!--                        <td class="col-left"><span class="truncate" th:title="${c.email}" th:text="${c.email}">-</span></td>-->
<!--                        <td th:text="${c.phone} ?: '-'">-</td>-->
<!--                        <td th:text="${c.gender} ?: '-'">-</td>-->
<!--                        <td>-->
<!--              <span class="badge"-->
<!--                    th:text="${(c.enabled ?: false) ? 'Enabled' : 'Disabled'}"-->
<!--                    th:classappend="${(c.enabled ?: false)} ? ' badge-success' : ' badge-danger'">Enabled</span>-->
<!--                        </td>-->
<!--                        <td th:text="${c.createdAt != null ? #temporals.format(c.createdAt, fmt) : '-'}">-</td>-->
<!--                        <td class="text-right" style="display:flex;gap:8px;justify-content:flex-end;flex-wrap:wrap;">-->
<!--                            &lt;!&ndash; Sửa: chỉ hiện khi có quyền EDIT &ndash;&gt;-->
<!--                            <a class="btn btn-ghost btn-sm"-->
<!--                               th:href="@{'/admin/customers/' + ${c.id} + '/edit'}"-->
<!--                               sec:authorize="hasAnyAuthority('CUSTOMER_EDIT','ROLE_ADMIN')">Sửa</a>-->

<!--                            &lt;!&ndash; Xóa: chỉ hiện khi có quyền DELETE &ndash;&gt;-->
<!--                            <form th:action="@{'/admin/customers/' + ${c.id} + '/delete'}"-->
<!--                                  method="post" style="display:inline"-->
<!--                                  onsubmit="return confirm('Xóa khách hàng này?')"-->
<!--                                  sec:authorize="hasAnyAuthority('CUSTOMER_DELETE','ROLE_ADMIN')">-->
<!--                                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>-->
<!--                                <button class="btn btn-ghost btn-sm" type="submit">Xóa</button>-->
<!--                            </form>-->
<!--                        </td>-->
<!--                    </tr>-->

<!--                    <tr th:if="${#lists.isEmpty(items)}">-->
<!--                        <td colspan="8" class="text-center" style="padding:18px;color:var(&#45;&#45;muted);">Không có dữ liệu</td>-->
<!--                    </tr>-->
<!--                    </tbody>-->
<!--                </table>-->
<!--            </div>-->
<!--        </div>-->

<!--        &lt;!&ndash; Pagination &ndash;&gt;-->
<!--        <div class="mt-4 pager" th:if="${page != null}">-->
<!--            <a class="btn btn-light"-->
<!--               th:href="@{/admin/customers(page=${page.number-1}, size=${page.size}, q=${q})}"-->
<!--               th:if="${!page.first}">« Trước</a>-->
<!--            <span>Trang <span th:text="${page.number + 1}">1</span>/<span th:text="${page.totalPages}">1</span></span>-->
<!--            <a class="btn btn-light"-->
<!--               th:href="@{/admin/customers(page=${page.number+1}, size=${page.size}, q=${q})}"-->
<!--               th:if="${!page.last}">Sau »</a>-->
<!--        </div>-->
<!--    </div>-->
<!--</section>-->
<!--</body>-->
<!--</html>-->
<!DOCTYPE html>
<html lang="vi"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/main}">
<head>
    <meta charset="UTF-8">
    <title>Khách hàng</title>
    <link rel="stylesheet" th:href="@{/css/customers/customer/list.css}">


</head>
<body>
<section layout:fragment="content" th:with="fmt='dd/MM/yyyy HH:mm'">
    <div class="alert alert-warning" sec:authorize="!hasAnyAuthority('CUSTOMER_VIEW','ROLE_ADMIN')">
        Bạn không có quyền xem danh sách khách hàng.
    </div>

    <div sec:authorize="hasAnyAuthority('CUSTOMER_VIEW','ROLE_ADMIN')" class="wrap">

        <h1 class="page-title">Khách hàng</h1>

        <!-- Search + Tạo mới -->
        <div style="display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:12px;">
            <form th:action="@{/admin/customers}" method="get"
                  style="display:flex;gap:10px;align-items:center;flex-wrap:wrap;">
                <input class="input" type="text" name="q" th:value="${q}" placeholder="Tìm theo email / họ tên"/>
                <button class="btn btn-primary" type="submit">Tìm</button>
            </form>

            <!-- Nút tạo mới căn phải, màu xanh lá -->
            <a class="btn btn-success"
               th:href="@{/admin/customers/new}"
               sec:authorize="hasAnyAuthority('CUSTOMER_CREATE','ROLE_ADMIN')">Tạo mới</a>
        </div>

        <!-- Messages -->
        <div class="mt-3">
            <div th:if="${saved}" class="alert alert-success">Đã lưu!</div>
            <div th:if="${deleted}" class="alert alert-success">Đã xóa!</div>
            <div th:if="${error}" class="alert alert-danger" th:text="${error}"></div>
        </div>

        <!-- Table -->
        <div class="table-card">
            <div class="overflow-x-auto mt-3">
                <table class="table">
                    <thead>
                    <tr>
                        <th>ID</th>
                        <th>Họ tên</th>
                        <th>Email</th>
                        <th>Điện thoại</th>
                        <th>Giới tính</th>
                        <th>Enabled</th>
                        <th>Tạo lúc</th>
                        <th>Thao tác</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="c : ${items}">
                        <td th:text="${c.id}">1</td>
                        <td><span class="truncate" th:title="${c.fullname}" th:text="${c.fullname} ?: '-'">-</span></td>
                        <td><span class="truncate" th:title="${c.email}" th:text="${c.email}">-</span></td>
                        <td th:text="${c.phone} ?: '-'">-</td>
                        <td th:text="${c.gender} ?: '-'">-</td>
                        <td>
                            <span class="badge"
                                  th:text="${(c.enabled ?: false) ? 'Enabled' : 'Disabled'}"
                                  th:classappend="${(c.enabled ?: false)} ? ' badge-success' : ' badge-danger'">Enabled</span>
                        </td>
                        <td th:text="${c.createdAt != null ? #temporals.format(c.createdAt, fmt) : '-'}">-</td>
                        <td style="display:flex;gap:8px;justify-content:center;flex-wrap:wrap;">
                            <a class="btn btn-warning btn-sm"
                               th:href="@{'/admin/customers/' + ${c.id} + '/edit'}"
                               sec:authorize="hasAnyAuthority('CUSTOMER_EDIT','ROLE_ADMIN')">Sửa</a>

                            <form th:action="@{'/admin/customers/' + ${c.id} + '/delete'}"
                                  method="post" style="display:inline"
                                  onsubmit="return confirm('Xóa khách hàng này?')"
                                  sec:authorize="hasAnyAuthority('CUSTOMER_DELETE','ROLE_ADMIN')">
                                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                                <button class="btn btn-danger btn-sm" type="submit">Xóa</button>
                            </form>
                        </td>
                    </tr>

                    <tr th:if="${#lists.isEmpty(items)}">
                        <td colspan="8" class="text-center" style="padding:18px;color:var(--muted);">Không có dữ liệu</td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Pagination -->
        <div class="mt-4 pager" th:if="${page != null}">
            <a class="btn btn-light"
               th:href="@{/admin/customers(page=${page.number-1}, size=${page.size}, q=${q})}"
               th:if="${!page.first}">« Trước</a>
            <span>Trang <span th:text="${page.number + 1}">1</span>/<span th:text="${page.totalPages}">1</span></span>
            <a class="btn btn-light"
               th:href="@{/admin/customers(page=${page.number+1}, size=${page.size}, q=${q})}"
               th:if="${!page.last}">Sau »</a>
        </div>
    </div>
</section>
</body>
</html>
