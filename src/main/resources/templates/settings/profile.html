<!DOCTYPE html>
<html lang="vi"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/main}">
<head>
    <meta charset="UTF-8">
    <title>Hồ sơ cá nhân</title>
    <link rel="stylesheet" th:href="@{/css/settings/profile.css}">
</head>
<body>
<section layout:fragment="content"
         th:with="fmt='dd/MM/yyyy HH:mm',
                  roles=${#authentication != null
                          ? #authentication.authorities.?[#strings.startsWith(#this.authority,'ROLE_')]
                          : T(java.util.Collections).emptyList()}">

    <h1>Hồ sơ cá nhân</h1>

    <!-- Thông báo -->
    <div th:if="${saved}" class="alert alert-success">Đã lưu thay đổi!</div>
    <div th:if="${error}" class="alert alert-danger" th:text="${error}"></div>

    <!-- Info hiện tại của tài khoản -->
    <div class="profile-card mb-4">
        <div class="profile-grid">
            <div>
                <div><strong>Username:</strong> <span th:text="${user.username}">username</span></div>
                <div><strong>Trạng thái:</strong>
                    <span th:text="${user.active ? 'Active' : 'Inactive'}">Active</span>
                </div>
                <div><strong>Tạo lúc:</strong>
                    <span th:text="${#temporals.format(user.createdAt, fmt)}">01/01/2025 10:00</span>
                </div>
            </div>

            <!-- Roles từ Spring Security (chỉ hiện role, không hiện permissions) -->
            <div>
                <div style="font-weight:600;margin-bottom:6px;">Roles</div>
                <div class="badge-list">
                    <span class="badge" th:each="ga : ${roles}" th:text="${ga.authority}">ROLE_ADMIN</span>
                    <span th:if="${#lists.isEmpty(roles)}">(Không có role)</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Form cập nhật -->
    <form th:action="@{/settings/profile}" th:object="${form}" method="post" class="space-y-3">
        <div>
            <label>Full name</label>
            <input type="text" th:field="*{fullName}" placeholder="Your name" required minlength="2" maxlength="120"/>
        </div>
        <div>
            <label>Email</label>
            <input type="email" th:field="*{email}" placeholder="you@example.com" maxlength="120"/>
        </div>
        <div>
            <label>Phone</label>
            <input type="text" th:field="*{phone}" placeholder="0xxxxxxxxx" pattern="^0\\d{9}$" maxlength="10"/>
        </div>

        <button type="submit" class="btn btn-primary">Lưu thay đổi</button>
    </form>
</section>
</body>
</html>
