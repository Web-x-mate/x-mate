<!doctype html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"><title>ƒê·∫∑t m·∫≠t kh·∫©u m·ªõi</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" th:href="@{/css/forgot.css}">
    <style>
        .field{position:relative}
        .toggle-eye{position:absolute;right:14px;top:50%;transform:translateY(-50%);cursor:pointer;opacity:.7}
        .btn{width:100%;padding:14px 18px;border:none;border-radius:28px;font-weight:700}
        .btn[disabled]{opacity:.45;cursor:not-allowed}
        .btn.enabled{opacity:1;cursor:pointer}
        .hint{color:#666;text-align:center;margin-top:8px}
        .error{color:#d00;text-align:center;margin:8px 0}
        .ok{color:#0a7a2a;text-align:center;margin:8px 0}
        .input{width:100%}
    </style>
</head>
<body>
<div class="backdrop">
    <div class="card" role="dialog" aria-modal="true">
        <button class="close" onclick="window.location.href='/'" aria-label="ƒê√≥ng">‚úï</button>
        <h1 class="title">ƒê·∫∑t l·∫°i m·∫≠t kh·∫©u</h1>

        <p class="ok" th:if="${msg}" th:text="${msg}"></p>
        <p class="error" th:if="${error}" th:text="${error}"></p>

        <form th:action="@{/auth/reset}" method="post" id="resetForm">
            <input type="hidden" name="token" th:value="${token}">

            <div class="field">
                <input class="input" type="password" id="pw1" name="newPassword"
                       placeholder="M·∫≠t kh·∫©u m·ªõi" autocomplete="new-password" required>
                <span class="toggle-eye" data-target="pw1" title="Hi·ªán/·∫©n">üëÅÔ∏è</span>
            </div>

            <div class="field">
                <input class="input" type="password" id="pw2" placeholder="Nh·∫≠p l·∫°i m·∫≠t kh·∫©u"
                       autocomplete="new-password" required>
                <span class="toggle-eye" data-target="pw2" title="Hi·ªán/·∫©n">üëÅÔ∏è</span>
            </div>

            <!-- N·∫øu b·∫°n B·∫¨T CSRF sau n√†y, b·ªçc ƒëi·ªÅu ki·ªán ƒë·ªÉ kh√¥ng l·ªói khi ƒëang t·∫Øt -->
            <!-- <input type="hidden" th:if="${_csrf != null}" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/> -->

            <button class="btn" id="submitBtn" type="submit" disabled>ƒê·∫∑t l·∫°i m·∫≠t kh·∫©u</button>
            <div class="hint" id="hint">T·ªëi thi·ªÉu 8 k√Ω t·ª±, tr√πng nhau.</div>
        </form>
    </div>
</div>

<script>
    (function(){
        const pw1 = document.getElementById('pw1');
        const pw2 = document.getElementById('pw2');
        const btn = document.getElementById('submitBtn');
        const hint = document.getElementById('hint');

        const MIN = 8; // b·∫°n mu·ªën bao nhi√™u k√Ω t·ª± th√¨ ƒë·ªïi ·ªü ƒë√¢y

        function sameAndValid(){
            const a = pw1.value.trim();
            const b = pw2.value.trim();
            const okLen = a.length >= MIN;
            const same = a === b && b.length > 0;
            return okLen && same;
        }

        function update(){
            if (sameAndValid()){
                btn.removeAttribute('disabled');
                btn.classList.add('enabled');
                hint.textContent = 'H·ª£p l·ªá. B·∫°n c√≥ th·ªÉ ƒë·∫∑t l·∫°i m·∫≠t kh·∫©u.';
            } else {
                btn.setAttribute('disabled','disabled');
                btn.classList.remove('enabled');
                if (pw1.value && pw2.value){
                    hint.textContent = (pw1.value.length < MIN)
                        ? `M·∫≠t kh·∫©u ph·∫£i ‚â• ${MIN} k√Ω t·ª±.`
                        : 'Hai m·∫≠t kh·∫©u ch∆∞a tr√πng nhau.';
                } else {
                    hint.textContent = `T·ªëi thi·ªÉu ${MIN} k√Ω t·ª±, tr√πng nhau.`;
                }
            }
        }

        pw1.addEventListener('input', update);
        pw2.addEventListener('input', update);

        // Enter ·ªü √¥ th·ª© hai c≈©ng submit n·∫øu h·ª£p l·ªá
        pw2.addEventListener('keydown', e => {
            if (e.key === 'Enter' && !btn.hasAttribute('disabled')) document.getElementById('resetForm').submit();
        });

        // N√∫t üëÅÔ∏è hi·ªán/·∫©n
        document.querySelectorAll('.toggle-eye').forEach(el=>{
            el.addEventListener('click', ()=>{
                const id = el.getAttribute('data-target');
                const ip = document.getElementById(id);
                ip.type = ip.type === 'password' ? 'text' : 'password';
            });
        });

        update(); // sync ban ƒë·∫ßu
    })();
</script>
</body>
</html>
