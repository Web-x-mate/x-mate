<!DOCTYPE html>
<html lang="vi"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/main}">
<body>
<section layout:fragment="content">
    <h1 th:text="${product != null and product.id != null} ? 'Sửa sản phẩm' : 'Tạo mới sản phẩm'">
        Tạo mới sản phẩm
    </h1>

    <form th:action="${product != null and product.id != null}
                      ? @{'/admin/catalog/products/' + ${product.id} + '/edit'}
                      : @{/admin/catalog/products/new}"
          method="post" class="form vstack gap-3">

        <!-- CSRF -->
        <input type="hidden" th:if="${_csrf != null}"
               th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>

        <!-- Name -->
        <div class="field">
            <label for="name">Name *</label>
            <input type="text" id="name" name="name" class="form-control"
                   th:value="${product != null} ? ${product.name} : ''" required>
        </div>

        <!-- Slug -->
        <div class="field">
            <label for="slug">Slug *</label>
            <input type="text" id="slug" name="slug" class="form-control"
                   th:value="${product != null} ? ${product.slug} : ''" required>
        </div>

        <!-- Category -->
        <div class="field">
            <label for="categoryId">Category *</label>
            <select id="categoryId" name="categoryId" class="form-select" required>
                <option th:if="${product == null or product.category == null}" value="" disabled selected>-- Chọn --</option>
                <option th:each="cat : ${categories}"
                        th:value="${cat.id}"
                        th:text="${cat.name}"
                        th:selected="${product != null and product.category != null} ? (${cat.id} == ${product.category.id}) : false">
                </option>
            </select>
        </div>

        <!-- Status (tùy enum của bạn; nếu có `statuses` trong model thì dùng th:each) -->
        <div class="field">
            <label for="status">Status *</label>
            <select id="status" name="status" class="form-select" required>
                <!-- Nếu bạn truyền model.addAttribute("statuses", ProductStatus.values()) thì dùng:
                <option th:each="st : ${statuses}" th:value="${st}" th:text="${st}"
                        th:selected="${product != null} ? (${st} == ${product.status}) : ( ${st.name()} == 'ACTIVE')"></option>
                -->
                <option th:value="ACTIVE"  th:selected="${product == null or product.status?.name() == 'ACTIVE'}">ACTIVE</option>
                <option th:value="INACTIVE" th:selected="${product != null and product.status?.name() == 'INACTIVE'}">INACTIVE</option>
            </select>
        </div>

        <!-- Description -->
        <div class="field">
            <label for="description">Description</label>
            <textarea id="description" name="description" class="form-control" rows="4"
                      th:text="${product != null} ? ${product.description} : ''"></textarea>
        </div>

        <!-- Material & Fit -->
        <div class="field-group d-flex gap-3">
            <div class="field flex-1">
                <label for="material">Material</label>
                <input type="text" id="material" name="material" class="form-control"
                       th:value="${product != null} ? ${product.material} : ''">
            </div>
            <div class="field flex-1">
                <label for="fit">Fit</label>
                <input type="text" id="fit" name="fit" class="form-control"
                       th:value="${product != null} ? ${product.fit} : ''">
            </div>
        </div>

        <!-- Gender -->
        <div class="field">
            <label for="gender">Gender *</label>
            <select id="gender" name="gender" class="form-select" required>
                <option th:value="UNISEX" th:selected="${product == null or product.gender?.name() == 'UNISEX'}">UNISEX</option>
                <option th:value="MEN"    th:selected="${product != null and product.gender?.name() == 'MEN'}">MEN</option>
                <option th:value="WOMEN"  th:selected="${product != null and product.gender?.name() == 'WOMEN'}">WOMEN</option>
            </select>
        </div>

        <!-- Actions -->
        <div class="actions d-flex align-items-center gap-2">
            <button type="submit" class="btn btn-primary"
                    th:text="${product != null and product.id != null} ? 'Cập nhật' : 'Tạo mới'">Tạo mới</button>
            <a th:href="@{/admin/catalog/products}" class="btn btn-outline-secondary">Quay lại danh sách</a>

            <!-- Chỉ hiện khi đang sửa (có id) -->
            <span class="ms-auto" th:if="${product != null and product.id != null}">
                <a th:href="@{|/admin/catalog/products/${product.id}/variants|}" class="btn btn-warning">Quản lý Variants</a>
                <a th:href="@{|/admin/catalog/products/${product.id}/media|}" class="btn btn-info">Quản lý Media</a>
            </span>
        </div>
    </form>
</section>
</body>
</html>
