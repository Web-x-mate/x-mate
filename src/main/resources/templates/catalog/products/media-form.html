<!DOCTYPE html>
<html lang="vi"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/main}">
<body>
<section layout:fragment="content">
    <h1 th:text="${media != null and media.id != null} ? 'Sửa Media' : 'Thêm Media'">Thêm Media</h1>

    <form th:action="${media != null and media.id != null}
                      ? @{'/admin/catalog/products/' + ${product.id} + '/media/edit/' + ${media.id}}
                      : @{'/admin/catalog/products/' + ${product.id} + '/media/new'}"
          method="post" enctype="multipart/form-data" class="vstack gap-3">

        <input type="hidden" th:if="${_csrf != null}" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>

        <div>
            <label for="mediaType">Media type</label>
            <select id="mediaType" name="mediaType" class="form-select" required>
                <option th:value="IMAGE"
                        th:selected="${media == null or media.mediaType?.name() == 'IMAGE'}">IMAGE</option>
                <option th:value="VIDEO"
                        th:selected="${media != null and media.mediaType?.name() == 'VIDEO'}">VIDEO</option>
            </select>
        </div>

        <div>
            <label for="file">File</label>
            <input id="file" name="file" type="file" class="form-control"
                   th:required="${media == null}">
            <small th:if="${media != null}">
                Ảnh hiện tại:
                <a th:href="${media.url}" th:text="${media.url}" target="_blank" rel="noopener">link</a>
                (để trống nếu không muốn thay)
            </small>
        </div>

        <div>
            <label for="variantId">Variant ID (tùy chọn)</label>
            <input id="variantId" name="variantId" type="number" class="form-control"
                   th:value="${media != null and media.variant != null} ? ${media.variant.id} : ''"
                   placeholder="Gắn ảnh theo variant (nếu có)">
        </div>

        <div class="form-check">
            <input class="form-check-input" id="primary" name="primary" type="checkbox"
                   th:checked="${media != null ? media.primary : false}">
            <label for="primary" class="form-check-label">Primary</label>
        </div>

        <div>
            <label for="sortOrder">Sort order</label>
            <input id="sortOrder" name="sortOrder" type="number" class="form-control"
                   th:value="${media != null ? media.sortOrder : 0}">
        </div>

        <div class="d-flex gap-2">
            <button type="submit" class="btn btn-primary"
                    th:text="${media != null and media.id != null} ? 'Cập nhật' : 'Tạo mới'">Tạo mới</button>
            <a th:href="@{|/admin/catalog/products/${product.id}/media|}" class="btn btn-outline-secondary">Quay lại</a>
        </div>
    </form>
</section>
</body>
</html>
