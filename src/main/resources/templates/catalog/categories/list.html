<!DOCTYPE html>
<html lang="vi"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/main}">
<head>
    <meta charset="UTF-8">
    <title>Danh sách danh mục</title>
    <link rel="stylesheet" th:href="@{/css/catalog/categories/list.css}">
</head>
<body>
<section layout:fragment="content" class="catalog-categories">

    <div class="alert alert-warning" sec:authorize="!hasAnyAuthority('CATEGORY_VIEW','ROLE_ADMIN')">
        Bạn không có quyền xem danh mục.
    </div>

    <div sec:authorize="hasAnyAuthority('CATEGORY_VIEW','ROLE_ADMIN')"
         class="wrap"
         th:with="currentDir=${param.direction != null ? param.direction[0] : 'desc'},
                  currentSort=${param.sort != null ? param.sort[0] : 'id'}">
        <h1 class="page-title">Danh sách danh mục</h1>

        <div class="toolbar">
            <form method="get" th:action="@{/admin/catalog/categories}" class="search-form">
                <input type="hidden" name="sort" th:value="${currentSort}">
                <input type="hidden" name="direction" th:value="${currentDir}">
                <input type="hidden" name="size" th:value="${page != null ? page.size : size}">
                <input type="text" name="q" th:value="${q}" placeholder="Tìm danh mục..." class="form-control" aria-label="Search categories">
                <button type="submit" class="btn btn-primary">Tìm kiếm</button>
            </form>

            <div class="toolbar-actions">
                <a class="btn btn-outline btn-outline-primary btn-sm"
                   th:href="@{/admin/catalog/categories(
                        page=0,
                        q=${q},
                        sort=${'id'},
                        direction=${currentDir == 'asc' ? 'desc' : 'asc'},
                        size=${page != null ? page.size : size}
                   )}"
                   th:utext="${currentDir == 'asc'} ? 'ID &#8595;' : 'ID &#8593;'"
                   title="Thay doi thu tu ID">
                    ID &#8593;
                </a>

                <a th:href="@{/admin/catalog/categories/new}"
                   class="btn btn-success"
                   sec:authorize="hasAnyAuthority('CATEGORY_CREATE','ROLE_ADMIN')">
                    Thêm danh mục
                </a>
            </div>
        </div>

        <div class="table-card">
            <div class="table-responsive">
                <table class="table align-middle table-centered">
                    <colgroup>
                        <col style="width:100px;">
                        <col style="width:28%;">
                        <col style="width:28%;">
                        <col style="width:22%;">
                        <col style="width:120px;">
                        <col style="width:200px;">
                    </colgroup>
                    <thead>
                    <tr>
                        <th class="col-center">ID</th>
                        <th class="col-left">Tên danh mục</th>
                        <th class="col-left">URL chuẩn hóa</th>
                        <th class="col-left">Danh muc cha</th>
                        <th class="col-center">Trạng thái</th>
                        <th class="col-right">Thao tác</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="c, iter : ${page != null ? page.content : categories}">
                        <td class="col-center" th:text="${c.id}">1</td>
                        <td class="col-left">
                            <span class="truncate" th:title="${c.name}" th:text="${c.name}">Danh mục A</span>
                        </td>
                        <td class="col-left">
                            <span class="truncate truncate-200" th:title="${c.slug}" th:text="${c.slug}">danh-muc-a</span>
                        </td>
                        <td class="col-left">
              <span class="truncate truncate-200"
                    th:title="${c.parent != null ? c.parent.name : '-'}"
                    th:text="${c.parent != null ? c.parent.name : '-'}">-</span>
                        </td>
                        <td class="col-center">
              <span th:text="${c.active} ? 'ACTIVE' : 'INACTIVE'"
                    th:class="${c.active} ? 'badge bg-success' : 'badge bg-secondary'">ACTIVE</span>
                        </td>
                        <td class="col-right">
                            <div class="actions">
                                <a th:href="@{|/admin/catalog/categories/${c.id}/edit|}"
                                   class="btn btn-sm btn-warning"
                                   sec:authorize="hasAnyAuthority('CATEGORY_EDIT','ROLE_ADMIN')">Sửa</a>

                                <a th:href="@{|/admin/catalog/categories/${c.id}/delete|}"
                                   onclick="return confirm('Xóa danh mục này?');"
                                   class="btn btn-sm btn-danger"
                                   sec:authorize="hasAnyAuthority('CATEGORY_DELETE','ROLE_ADMIN')">Xóa</a>
                            </div>
                        </td>
                    </tr>

                    <tr th:if="${page == null || #lists.isEmpty(page.content)}">
                        <td colspan="6" class="col-center empty-row">Không có dữ liệu</td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div th:replace="~{layout/components/_pagination :: body(page=${page}, baseUrl='/admin/catalog/categories', q=${q}, sort=${currentSort}, direction=${currentDir}, size=${page != null ? page.size : size})}"></div>
    </div>
</section>
</body>
</html>
