<!-- src/main/resources/templates/sales/orders/list.html (v√≠ d·ª• ƒë∆∞·ªùng d·∫´n) -->
<!DOCTYPE html>
<html lang="vi"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/main}">
<head>
    <meta charset="UTF-8">
    <title>Danh s√°ch ƒë∆°n h√†ng</title>
    <style>
        .table thead th { text-align: center; }
        .table tbody td { text-align: center; }

        .btn-create {
            font-weight: 900;
            font-size: 1.125rem;
            background: linear-gradient(90deg, #10b981, #059669);
            border: none; color: white;
            box-shadow: 0 2px 6px rgba(16, 185, 129, .4);
            transition: transform .15s, box-shadow .15s;
            padding: .63rem 1.26rem; border-radius: .675rem;
        }
        .btn-create:hover { transform: translateY(-2px); box-shadow: 0 4px 10px rgba(16, 185, 129, .45); }

        .badge {
            display: inline-flex; align-items: center; gap: .315rem;
            font-weight: 600; border-radius: .45rem;
            padding: .225rem .45rem; font-size: .765rem;
        }
        .bg-light{background:#f1f5f9;color:#0f172a}
        .bg-secondary{background:#e2e8f0;color:#0f172a}
        .bg-primary{background:#0ea5e9;color:#fff}
        .bg-success{background:#22c55e;color:#fff}
        .bg-danger{background:#ef4444;color:#fff}
        .bg-info{background:#38bdf8;color:#0f172a}
        .bg-warning{background:#fbbf24;color:#0f172a}
        .text-dark{color:#0f172a}
        .me-1{margin-right:.225rem}

        .btn-lg{
            font-size:.9rem; font-weight:700;
            padding:.72rem 1.26rem; border-radius:.675rem;
        }

        /* N√∫t h√†nh ƒë·ªông */
        .btn-action{
            font-weight:600; border-radius:7.2px;
            padding:.36rem .81rem; font-size:.81rem;
            transition:all .15s ease;
        }
        .btn-view{ background:#e2e8f0; color:#0f172a; border:none; }
        .btn-view:hover{ background:#cbd5e1; }
        .btn-edit{ background:#fbbf24; color:#0f172a; border:none; }
        .btn-edit:hover{ background:#f59e0b; }
        .btn-delete{ background:#ef4444; color:#fff; border:none; }
        .btn-delete:hover{ background:#dc2626; }

        /* L∆∞·ªõi filter 6 c·ªôt (nh·∫π -10%) */
        .filter-grid{
            display:grid; grid-template-columns:repeat(6,1fr);
            gap:.675rem; align-items:stretch; margin-bottom:.9rem;
        }
        .filter-grid .cell > *{
            height:43px; width:100%; border-radius:9px; font-size:.855rem;
            display:flex; align-items:center; justify-content:center;
        }
        .filter-grid .btn{ font-weight:700; }
        @media (max-width: 992px){ .filter-grid{ grid-template-columns:repeat(3,1fr);} }
        @media (max-width: 576px){ .filter-grid{ grid-template-columns:repeat(2,1fr);} }

        /* Pagination ‚Äî pills (gi·ªëng ·∫£nh) */
        .pagination{ display:flex; gap:.5rem; align-items:center; }
        .page-item{ list-style:none; }
        .page-link{
            display:inline-flex; align-items:center; justify-content:center;
            min-width:40px; height:36px; padding:0 .75rem;
            border-radius:10px; border:1px solid #e2e8f0;
            background:#fff; color:#0f172a; font-weight:700; text-decoration:none;
            transition:background .15s, border-color .15s, color .15s;
        }
        .page-item.active .page-link{ background:#16a34a; color:#fff; border-color:#16a34a; }
        .page-item.disabled .page-link{
            background:#f1f5f9; color:#94a3b8; border-color:#e2e8f0; pointer-events:none;
        }
        .page-link:hover{ background:#f8fafc; }
        .page-title{
            font-size: 1.75rem;  /* ch·ªânh con s·ªë n√†y ƒë·ªÉ ra ƒë√∫ng c·ª° */
            font-weight: 800;
            line-height: 1.5;
            text-align: center;
            margin: 0 0 18px;
        }
    </style>
</head>
<body>
<section layout:fragment="content">
    <div sec:authorize="hasAnyAuthority('ORDER_VIEW','ROLE_ADMIN')">

        <h1 class="page-title">Danh s√°ch ƒë∆°n h√†ng</h1>

        <!-- B·ªô l·ªçc -->
        <form method="get" class="filter-grid">
            <div class="cell">
                <input class="form-control" name="q" th:value="${q}" placeholder=" M√£ ƒë∆°n ho·∫∑c t√™n kh√°ch h√†ng...">
            </div>
            <div class="cell">
                <select class="form-select" name="status">
                    <option value="">Tr·∫°ng th√°i</option>
                    <option th:each="s: ${orderStatuses}" th:value="${s}" th:text="${s}"
                            th:selected="${s.name() == status}"></option>
                </select>
            </div>
            <div class="cell">
                <select class="form-select" name="payment">
                    <option value="">Thanh to√°n</option>
                    <option th:each="s: ${paymentStatuses}" th:value="${s}" th:text="${s}"
                            th:selected="${s.name() == payment}"></option>
                </select>
            </div>
            <div class="cell">
                <button class="btn btn-primary w-100" type="submit">T√¨m ki·∫øm</button>
            </div>
            <div class="cell">
                <a class="btn btn-secondary w-100" th:href="@{/admin/sales/orders}">ƒê·∫∑t l·∫°i</a>
            </div>
            <div class="cell" sec:authorize="hasAnyAuthority('ORDER_CREATE','ROLE_ADMIN')">
                <a th:href="@{/admin/sales/orders/new}" class="btn btn-create w-100">T·∫°o ƒë∆°n</a>
            </div>
        </form>

        <!-- B·∫£ng -->
        <div class="table-responsive">
            <table class="table table-hover align-middle w-100">
                <thead class="table-light">
                <tr>
                    <th>ID</th>
                    <th>M√£ ƒë∆°n</th>
                    <th>Kh√°ch h√†ng</th>
                    <th>Tr·∫°ng th√°i</th>
                    <th>Thanh to√°n</th>
                    <th>V·∫≠n chuy·ªÉn</th>
                    <th class="text-end">T·ªïng ti·ªÅn</th>
                    <th>Ng√†y t·∫°o</th>
                    <th>H√†nh ƒë·ªông</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="o : ${ (page != null and page.content != null) ? page.content : T(java.util.Collections).emptyList() }">
                    <td th:text="${o.id}">1</td>
                    <td th:text="${o.code}">ORD-001</td>
                    <td th:text="${o.customer != null ? o.customer.fullname : '‚Äî'}">‚Äî</td>

                    <!-- ORDER STATUS -->
                    <td th:switch="${o.status != null ? o.status.name() : ''}">
                        <span class="badge bg-warning text-dark" th:case="'PENDING_PAYMENT'">üí≥ <span th:text="${o.status}"></span></span>
                        <span class="badge bg-primary"            th:case="'PLACED'">üßæ <span th:text="${o.status}"></span></span>
                        <span class="badge bg-info text-dark"     th:case="'CONFIRMED'">‚úÖ <span th:text="${o.status}"></span></span>
                        <span class="badge bg-info text-dark"     th:case="'PACKED'">üì¶ <span th:text="${o.status}"></span></span>
                        <span class="badge bg-info text-dark"     th:case="'SHIPPING'">üöö <span th:text="${o.status}"></span></span>
                        <span class="badge bg-success"            th:case="'DELIVERED'">üéâ <span th:text="${o.status}"></span></span>
                        <span class="badge bg-secondary"          th:case="'CANCELLED'">‚ùå <span th:text="${o.status}"></span></span>
                        <span class="badge bg-danger"             th:case="'FAILED'">üî• <span th:text="${o.status}"></span></span>
                        <span class="badge bg-warning text-dark"  th:case="'PENDING'">‚è≥ <span th:text="${o.status}"></span></span>
                        <span class="badge bg-light text-dark"    th:case="*">‚ö™ ‚Äî</span>
                    </td>

                    <!-- PAYMENT STATUS -->
                    <td th:switch="${o.paymentStatus != null ? o.paymentStatus.name() : ''}">
                        <span class="badge bg-success"            th:case="'PAID'">üí∞ PAID</span>
                        <span class="badge bg-secondary"          th:case="'REFUNDED'">‚Ü©Ô∏è REFUNDED</span>
                        <span class="badge bg-danger"             th:case="'FAILED'">‚ùå FAILED</span>
                        <span class="badge bg-warning text-dark"  th:case="*">‚ö†Ô∏è UNPAID</span>
                    </td>

                    <!-- SHIPPING STATUS -->
                    <td>
                        <span class="badge bg-info text-dark" th:if="${o.shippingStatus == 'SHIPPED'}">üöÄ SHIPPED</span>
                        <span class="badge bg-success" th:if="${o.shippingStatus == 'DELIVERED'}">‚úÖ DELIVERED</span>
                        <span class="badge bg-secondary" th:if="${o.shippingStatus == 'RETURNED'}">‚Ü©Ô∏è RETURNED</span>
                        <span class="badge bg-light text-dark"
                              th:if="${o.shippingStatus == null || o.shippingStatus == 'NOT_SHIPPED'}">üì¶ NOT_SHIPPED</span>
                    </td>

                    <td class="text-end" th:text="${#numbers.formatDecimal(o.total, 0, 'COMMA', 0, 'POINT')}">0</td>
                    <td th:text="${#temporals.format(o.createdAt, 'dd/MM/yyyy HH:mm')}">15/10/2025 15:30</td>

                    <td>
                        <div class="d-flex gap-2">
<!--                            <a th:href="@{|/admin/sales/orders/${o.id}|}" class="btn btn-action btn-view">Xem</a>-->
                            <a th:href="@{|/admin/sales/orders/${o.id}/edit|}" class="btn btn-action btn-edit"
                               sec:authorize="hasAnyAuthority('ORDER_EDIT','ROLE_ADMIN')">S·ª≠a</a>
                            <a th:href="@{|/admin/sales/orders/${o.id}/delete|}" class="btn btn-action btn-delete"
                               sec:authorize="hasAnyAuthority('ORDER_DELETE','ROLE_ADMIN')"
                               onclick="return confirm('X√≥a ƒë∆°n h√†ng n√†y?')">X√≥a</a>
                        </div>
                    </td>
                </tr>

                <tr th:if="${page == null or #lists.isEmpty(page.content)}">
                    <td colspan="9" class="text-center text-muted py-4">Kh√¥ng c√≥ d·ªØ li·ªáu</td>
                </tr>
                </tbody>
            </table>
        </div>

        <!-- PH√ÇN TRANG: pill, gi·ªØ q -->
        <div th:replace="~{layout/components/_pagination :: body(
                page=${page},
                baseUrl='/admin/sales/orders',
                q=${q}
        )}"></div>

    </div>
</section>
</body>
</html>
