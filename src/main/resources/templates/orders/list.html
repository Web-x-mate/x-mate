<!--<!DOCTYPE html>-->
<!--<html lang="vi"-->
<!--      xmlns:th="http://www.thymeleaf.org"-->
<!--      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"-->
<!--      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"-->
<!--      layout:decorate="~{layout/main}">-->
<!--<body>-->
<!--<section layout:fragment="content">-->
<!--    &lt;!&ndash; Khi KHÔNG có quyền VIEW &ndash;&gt;-->
<!--    <div class="alert alert-warning" sec:authorize="!hasAnyAuthority('ORDER_VIEW','ROLE_ADMIN')">-->
<!--        Bạn không có quyền xem danh sách đơn hàng.-->
<!--    </div>-->

<!--    &lt;!&ndash; Khi CÓ quyền VIEW &ndash;&gt;-->
<!--    <div sec:authorize="hasAnyAuthority('ORDER_VIEW','ROLE_ADMIN')">-->
<!--        <h1 class="page-title">Orders</h1>-->

<!--        <div class="d-flex align-items-center justify-content-between mb-3 gap-2">-->
<!--            <form method="get" class="d-flex gap-2">-->
<!--                <input class="form-control" name="q" th:value="${q}" placeholder="Search code / customer name...">-->
<!--                <select class="form-select" name="status">-->
<!--                    <option value="">Status</option>-->
<!--                    <option th:each="s: ${orderStatuses}" th:value="${s}" th:text="${s}" th:selected="${s.name()==status}"></option>-->
<!--                </select>-->
<!--                <select class="form-select" name="payment">-->
<!--                    <option value="">Payment</option>-->
<!--                    <option th:each="s: ${paymentStatuses}" th:value="${s}" th:text="${s}" th:selected="${s.name()==payment}"></option>-->
<!--                </select>-->
<!--                <select class="form-select" name="shipping">-->
<!--                    <option value="">Shipping</option>-->
<!--                    <option th:each="s: ${shippingStatuses}" th:value="${s}" th:text="${s}" th:selected="${s.name()==shipping}"></option>-->
<!--                </select>-->
<!--                <button class="btn btn-primary">Search</button>-->
<!--            </form>-->

<!--            &lt;!&ndash; Nút tạo chỉ hiện khi có quyền CREATE &ndash;&gt;-->
<!--            <a th:href="@{/admin/sales/orders/new}"-->
<!--               class="btn btn-success"-->
<!--               sec:authorize="hasAnyAuthority('ORDER_CREATE','ROLE_ADMIN')">+ Tạo đơn</a>-->
<!--        </div>-->

<!--        <div class="table-responsive">-->
<!--            <table class="table table-striped table-hover align-middle w-100">-->
<!--                <thead class="table-light">-->
<!--                <tr>-->
<!--                    <th>ID</th><th>Code</th><th>Customer</th><th>Status</th>-->
<!--                    <th>Payment</th><th>Shipping</th><th>Total</th><th style="width:220px">Actions</th>-->
<!--                </tr>-->
<!--                </thead>-->
<!--                <tbody>-->
<!--                <tr th:each="o : ${page != null ? page.content : {}}">-->
<!--                    <td th:text="${o.id}">1</td>-->
<!--                    <td th:text="${o.code}">ORD-...</td>-->
<!--                    <td th:text="${o.customer != null ? o.customer.fullname : '—'}">—</td>-->
<!--                    <td th:text="${o.status}">PENDING</td>-->
<!--                    <td th:text="${o.paymentStatus}">UNPAID</td>-->
<!--                    <td th:text="${o.shippingStatus}">NOT_SHIPPED</td>-->
<!--                    <td th:text="${#numbers.formatDecimal(o.total, 0, 'COMMA', 2, 'POINT')}">0</td>-->
<!--                    <td class="d-flex gap-2">-->
<!--                        &lt;!&ndash; Edit: chỉ hiển thị khi có quyền EDIT &ndash;&gt;-->
<!--                        <a th:href="@{|/admin/sales/orders/${o.id}/edit|}"-->
<!--                           class="btn btn-sm btn-warning"-->
<!--                           sec:authorize="hasAnyAuthority('ORDER_EDIT','ROLE_ADMIN')">Edit</a>-->

<!--                        &lt;!&ndash; Delete: chỉ hiển thị khi có quyền DELETE &ndash;&gt;-->
<!--                        <a th:href="@{|/admin/sales/orders/${o.id}/delete|}"-->
<!--                           class="btn btn-sm btn-danger"-->
<!--                           onclick="return confirm('Xóa đơn hàng này?')"-->
<!--                           sec:authorize="hasAnyAuthority('ORDER_DELETE','ROLE_ADMIN')">Delete</a>-->
<!--                    </td>-->
<!--                </tr>-->

<!--                <tr th:if="${page == null || #lists.isEmpty(page.content)}">-->
<!--                    <td colspan="8" class="text-center">No data</td>-->
<!--                </tr>-->
<!--                </tbody>-->
<!--            </table>-->
<!--        </div>-->

<!--        <div th:replace="~{layout/components/_pagination :: body(page=${page}, baseUrl='/admin/sales/orders', q=${q})}"></div>-->
<!--    </div>-->
<!--</section>-->
<!--</body>-->
<!--</html>-->
<!DOCTYPE html>
<html lang="vi"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/main}">
<head>
    <meta charset="UTF-8">
    <title>Danh sách đơn hàng</title>
    <style>
        .table thead th { text-align: center; }
        .table tbody td { text-align: center; }

        .btn-create {
            font-weight: 900;
            font-size: 1.25rem;
            background: linear-gradient(90deg, #10b981, #059669);
            border: none;
            color: white;
            box-shadow: 0 2px 6px rgba(16, 185, 129, .4);
            transition: transform .15s, box-shadow .15s;
        }
        .btn-create:hover { transform: translateY(-2px); box-shadow: 0 4px 10px rgba(16, 185, 129, .45); }

        .badge {
            display: inline-flex; align-items: center; gap: .35rem;
            font-weight: 600; border-radius: .5rem; padding: .25rem .5rem;
            font-size: .85rem;
        }
        .bg-light{background:#f1f5f9;color:#0f172a}
        .bg-secondary{background:#e2e8f0;color:#0f172a}
        .bg-primary{background:#0ea5e9;color:#fff}
        .bg-success{background:#22c55e;color:#fff}
        .bg-danger{background:#ef4444;color:#fff}
        .bg-info{background:#38bdf8;color:#0f172a}
        .bg-warning{background:#fbbf24;color:#0f172a}
        .text-dark{color:#0f172a}
        .me-1{margin-right:.25rem}
        .btn-lg { font-size: 1rem; font-weight: 700; padding: .8rem 1.4rem; border-radius: .75rem; }

        /* Nút hành động */
        .btn-action { font-weight: 600; border-radius: 8px; padding: 0.4rem 0.9rem; font-size: 0.9rem; transition: all 0.15s ease; }
        .btn-view { background: #e2e8f0; color: #0f172a; border: none; }
        .btn-view:hover { background: #cbd5e1; }
        .btn-edit { background: #fbbf24; color: #0f172a; border: none; }
        .btn-edit:hover { background: #f59e0b; }
        .btn-delete { background: #ef4444; color: #fff; border: none; }
        .btn-delete:hover { background: #dc2626; }

        /* Lưới filter 6 cột */
        .filter-grid{ display:grid; grid-template-columns: repeat(6, 1fr); gap:.75rem; align-items:stretch; margin-bottom:1rem; }
        .filter-grid .cell > *{ height:48px; width:100%; border-radius:10px; font-size:.95rem; display:flex; align-items:center; justify-content:center; }
        .filter-grid .btn{ font-weight:700; }

        @media (max-width: 992px){ .filter-grid{ grid-template-columns: repeat(3, 1fr); } }
        @media (max-width: 576px){ .filter-grid{ grid-template-columns: repeat(2, 1fr); } }
    </style>
</head>
<body>
<section layout:fragment="content">
    <div sec:authorize="hasAnyAuthority('ORDER_VIEW','ROLE_ADMIN')">
        <h1 class="page-title mb-3 fw-bold">Danh sách đơn hàng</h1>

        <!-- Filter 6 ô trên 1 hàng -->
        <form method="get" class="filter-grid">
            <div class="cell">
                <input class="form-control" name="q" th:value="${q}" placeholder=" Mã đơn hoặc tên khách hàng...">
            </div>
            <div class="cell">
                <select class="form-select" name="status">
                    <option value="">Trạng thái</option>
                    <option th:each="s: ${orderStatuses}" th:value="${s}" th:text="${s}"
                            th:selected="${s.name() == status}"></option>
                </select>
            </div>
            <div class="cell">
                <select class="form-select" name="payment">
                    <option value="">Thanh toán</option>
                    <option th:each="s: ${paymentStatuses}" th:value="${s}" th:text="${s}"
                            th:selected="${s.name() == payment}"></option>
                </select>
            </div>
            <div class="cell">
                <button class="btn btn-primary w-100" type="submit">Tìm kiếm</button>
            </div>
            <div class="cell">
                <a class="btn btn-secondary w-100" th:href="@{/admin/sales/orders}">Đặt lại</a>
            </div>
            <div class="cell" sec:authorize="hasAnyAuthority('ORDER_CREATE','ROLE_ADMIN')">
                <a th:href="@{/admin/sales/orders/new}" class="btn btn-create w-100">Tạo đơn</a>
            </div>
        </form>

        <!-- Bảng -->
        <div class="table-responsive">
            <table class="table table-hover align-middle w-100">
                <thead class="table-light">
                <tr>
                    <th>ID</th>
                    <th>Mã đơn</th>
                    <th>Khách hàng</th>
                    <th>Trạng thái</th>
                    <th>Thanh toán</th>
                    <th>Vận chuyển</th>
                    <th class="text-end">Tổng tiền</th>
                    <th>Ngày tạo</th>
                    <th>Hành động</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="o : ${ (page != null and page.content != null) ? page.content : T(java.util.Collections).emptyList() }">
                    <td th:text="${o.id}">1</td>
                    <td th:text="${o.code}">ORD-001</td>
                    <td th:text="${o.customer != null ? o.customer.fullname : '—'}">—</td>

                    <!-- ORDER STATUS (enum) -->
                    <td th:switch="${o.status != null ? o.status.name() : ''}">
                        <span class="badge bg-warning text-dark" th:case="'PENDING_PAYMENT'">💳 <span th:text="${o.status}"></span></span>
                        <span class="badge bg-primary"            th:case="'PLACED'">🧾 <span th:text="${o.status}"></span></span>
                        <span class="badge bg-info text-dark"     th:case="'CONFIRMED'">✅ <span th:text="${o.status}"></span></span>
                        <span class="badge bg-info text-dark"     th:case="'PACKED'">📦 <span th:text="${o.status}"></span></span>
                        <span class="badge bg-info text-dark"     th:case="'SHIPPING'">🚚 <span th:text="${o.status}"></span></span>
                        <span class="badge bg-success"            th:case="'DELIVERED'">🎉 <span th:text="${o.status}"></span></span>
                        <span class="badge bg-secondary"          th:case="'CANCELLED'">❌ <span th:text="${o.status}"></span></span>
                        <span class="badge bg-danger"             th:case="'FAILED'">🔥 <span th:text="${o.status}"></span></span>
                        <span class="badge bg-warning text-dark"  th:case="'PENDING'">⏳ <span th:text="${o.status}"></span></span>
                        <span class="badge bg-light text-dark"    th:case="*">⚪ —</span>
                    </td>

                    <!-- PAYMENT STATUS (enum) -->
                    <td th:switch="${o.paymentStatus != null ? o.paymentStatus.name() : ''}">
                        <span class="badge bg-success"            th:case="'PAID'">💰 PAID</span>
                        <span class="badge bg-secondary"          th:case="'REFUNDED'">↩️ REFUNDED</span>
                        <span class="badge bg-danger"             th:case="'FAILED'">❌ FAILED</span>
                        <span class="badge bg-warning text-dark"  th:case="*">⚠️ UNPAID</span>
                    </td>

                    <!-- SHIPPING STATUS (String) -->
                    <td>
                        <span class="badge bg-info text-dark" th:if="${o.shippingStatus == 'SHIPPED'}">🚀 SHIPPED</span>
                        <span class="badge bg-success" th:if="${o.shippingStatus == 'DELIVERED'}">✅ DELIVERED</span>
                        <span class="badge bg-secondary" th:if="${o.shippingStatus == 'RETURNED'}">↩️ RETURNED</span>
                        <span class="badge bg-light text-dark"
                              th:if="${o.shippingStatus == null || o.shippingStatus == 'NOT_SHIPPED'}">📦 NOT_SHIPPED</span>
                    </td>

                    <td class="text-end" th:text="${#numbers.formatDecimal(o.total, 0, 'COMMA', 0, 'POINT')}">0</td>
                    <td th:text="${#temporals.format(o.createdAt, 'dd/MM/yyyy HH:mm')}">15/10/2025 15:30</td>

                    <td>
                        <div class="d-flex gap-2">
                            <a th:href="@{|/admin/sales/orders/${o.id}|}" class="btn btn-action btn-view">Xem</a>
                            <a th:href="@{|/admin/sales/orders/${o.id}/edit|}" class="btn btn-action btn-edit"
                               sec:authorize="hasAnyAuthority('ORDER_EDIT','ROLE_ADMIN')">Sửa</a>
                            <a th:href="@{|/admin/sales/orders/${o.id}/delete|}" class="btn btn-action btn-delete"
                               sec:authorize="hasAnyAuthority('ORDER_DELETE','ROLE_ADMIN')"
                               onclick="return confirm('Xóa đơn hàng này?')">Xóa</a>
                        </div>
                    </td>
                </tr>

                <tr th:if="${page == null or #lists.isEmpty(page.content)}">
                    <td colspan="9" class="text-center text-muted py-4">Không có dữ liệu</td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
</section>
</body>
</html>
