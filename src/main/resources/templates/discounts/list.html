<!--<!DOCTYPE html>-->
<!--<html lang="vi"-->
<!--      xmlns:th="http://www.thymeleaf.org"-->
<!--      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"-->
<!--      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"-->
<!--      layout:decorate="~{layout/main}">-->
<!--<body>-->
<!--<section layout:fragment="content">-->
<!--    &lt;!&ndash; Khi KHÔNG có quyền VIEW &ndash;&gt;-->
<!--    <div class="alert alert-warning" sec:authorize="!hasAnyAuthority('DISCOUNT_VIEW','ROLE_ADMIN')">-->
<!--        Bạn không có quyền xem danh sách discounts.-->
<!--    </div>-->

<!--    &lt;!&ndash; Khi CÓ quyền VIEW &ndash;&gt;-->
<!--    <div sec:authorize="hasAnyAuthority('DISCOUNT_VIEW','ROLE_ADMIN')">-->
<!--        <h1 class="page-title">Discounts</h1>-->

<!--        &lt;!&ndash; Toolbar: Search + Add new &ndash;&gt;-->
<!--        <div class="d-flex align-items-center justify-content-between gap-2 mb-3">-->
<!--            <form method="get" th:action="@{/admin/discounts}" class="d-flex align-items-center gap-2">-->
<!--                <input class="form-control" type="text" name="q" th:value="${q}" placeholder="Search code or JSON...">-->
<!--                <button class="btn btn-primary" type="submit">Search</button>-->
<!--            </form>-->

<!--            &lt;!&ndash; Nút tạo mới chỉ hiển thị khi có quyền CREATE &ndash;&gt;-->
<!--            <a th:href="@{/admin/discounts/new}"-->
<!--               class="btn btn-success"-->
<!--               sec:authorize="hasAnyAuthority('DISCOUNT_CREATE','ROLE_ADMIN')">+ New discount</a>-->
<!--        </div>-->

<!--        <div class="table-responsive">-->
<!--            <table class="table table-striped table-hover align-middle w-100">-->
<!--                <colgroup>-->
<!--                    <col style="width: 70px;">-->
<!--                    <col style="width: 90px;">-->
<!--                    <col style="width: 120px;">-->
<!--                    <col style="width: 110px;">-->
<!--                    <col>-->
<!--                    <col style="width: 120px;">-->
<!--                    <col style="width: 170px;">-->
<!--                    <col style="width: 170px;">-->
<!--                    <col style="width: 110px;">-->
<!--                    <col style="width: 110px;">-->
<!--                    <col style="width: 110px;">-->
<!--                    <col style="width: 160px;">-->
<!--                </colgroup>-->
<!--                <thead class="table-light">-->
<!--                <tr>-->
<!--                    <th>ID</th>-->
<!--                    <th>Type</th>-->
<!--                    <th>Code</th>-->
<!--                    <th>Value Type</th>-->
<!--                    <th>Value</th>-->
<!--                    <th>Min order</th>-->
<!--                    <th>Start</th>-->
<!--                    <th>End</th>-->
<!--                    <th>Limit</th>-->
<!--                    <th>Used</th>-->
<!--                    <th>Status</th>-->
<!--                    <th>Actions</th>-->
<!--                </tr>-->
<!--                </thead>-->

<!--                <tbody>-->
<!--                <tr th:each="d : ${page?.content}">-->
<!--                    <td th:text="${d.id}">1</td>-->
<!--                    <td th:text="${d.type}">CODE</td>-->
<!--                    <td th:text="${d.code}">SAVE10</td>-->
<!--                    <td th:text="${d.valueType}">PERCENT</td>-->
<!--                    <td>-->
<!--                        <span th:if="${d.valueType?.name() == 'PERCENT'}"-->
<!--                              th:text="${#numbers.formatDecimal(d.valueAmount,1,2)} + ' %'">10 %</span>-->
<!--                        <span th:if="${d.valueType?.name() == 'FIXED'}"-->
<!--                              th:text="${#numbers.formatDecimal(d.valueAmount,1,2)}">50000</span>-->
<!--                    </td>-->
<!--                    <td th:text="${#numbers.formatDecimal(d.minOrder?:0,1,2)}">0</td>-->
<!--                    <td th:text="${d.startAt != null ? #temporals.format(d.startAt,'yyyy-MM-dd HH:mm') : ''}"></td>-->
<!--                    <td th:text="${d.endAt != null ? #temporals.format(d.endAt,'yyyy-MM-dd HH:mm') : ''}"></td>-->
<!--                    <td th:text="${d.usageLimit}">100</td>-->
<!--                    <td th:text="${d.usedCount}">5</td>-->
<!--                    <td>-->
<!--                        <span th:class="'badge ' + (${d.status} == 'ACTIVE' ? 'bg-success' : 'bg-secondary')"-->
<!--                              th:text="${d.status}">ACTIVE</span>-->
<!--                    </td>-->
<!--                    <td class="d-flex gap-2">-->
<!--                        &lt;!&ndash; Edit: chỉ hiển thị khi có quyền EDIT &ndash;&gt;-->
<!--                        <a th:href="@{|/admin/discounts/${d.id}/edit|}"-->
<!--                           class="btn btn-sm btn-warning"-->
<!--                           sec:authorize="hasAnyAuthority('DISCOUNT_EDIT','ROLE_ADMIN')">Edit</a>-->

<!--                        &lt;!&ndash; Delete: chỉ hiển thị khi có quyền DELETE &ndash;&gt;-->
<!--                        <a th:href="@{|/admin/discounts/${d.id}/delete|}"-->
<!--                           onclick="return confirm('Xoá discount này?');"-->
<!--                           class="btn btn-sm btn-danger"-->
<!--                           sec:authorize="hasAnyAuthority('DISCOUNT_DELETE','ROLE_ADMIN')">Delete</a>-->
<!--                    </td>-->
<!--                </tr>-->

<!--                <tr th:if="${page == null || #lists.isEmpty(page.content)}">-->
<!--                    <td colspan="12" class="text-center">No data</td>-->
<!--                </tr>-->
<!--                </tbody>-->
<!--            </table>-->
<!--        </div>-->

<!--        &lt;!&ndash; Pagination &ndash;&gt;-->
<!--        <div th:replace="~{layout/components/_pagination :: body(page=${page}, baseUrl='/admin/discounts', q=${q})}"></div>-->
<!--    </div>-->
<!--</section>-->
<!--</body>-->
<!--</html>-->
<!DOCTYPE html>
<html lang="vi"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/main}">
<head>
    <meta charset="UTF-8">
    <title>Danh sách giảm giá</title>
    <style>
        /* Căn giữa header & cells cho đồng bộ Orders */
        .table thead th { text-align:center; }
        .table tbody td { text-align:center; }

        /* Badge màu sắc dùng chung */
        .badge {
            display:inline-flex; align-items:center; gap:.35rem;
            font-weight:600; border-radius:.5rem; padding:.25rem .5rem; font-size:.85rem;
        }
        .bg-light{background:#f1f5f9;color:#0f172a}
        .bg-secondary{background:#e2e8f0;color:#0f172a}
        .bg-primary{background:#3b82f6;color:#fff}
        .bg-success{background:#22c55e;color:#fff}
        .bg-danger{background:#ef4444;color:#fff}
        .bg-info{background:#38bdf8;color:#0f172a}
        .bg-warning{background:#fbbf24;color:#0f172a}

        /* Nút tạo mới giống Orders */
        .btn-create{
            font-weight:900; font-size:1.05rem;
            background:linear-gradient(90deg,#10b981,#059669);
            border:none; color:#fff;
            box-shadow:0 2px 6px rgba(16,185,129,.35);
            border-radius:10px; height:48px;
            transition:transform .15s, box-shadow .15s;
        }
        .btn-create:hover{ transform:translateY(-2px); box-shadow:0 4px 10px rgba(16,185,129,.45); }

        /* Nút actions giống Orders */
        .btn-action{ font-weight:600; border-radius:8px; padding:.4rem .9rem; font-size:.9rem; transition:.15s; }
        .btn-edit{ background:#fbbf24; color:#0f172a; border:none; }
        .btn-edit:hover{ background:#f59e0b; }
        .btn-delete{ background:#ef4444; color:#fff; border:none; }
        .btn-delete:hover{ background:#dc2626; }

        /* Hàng lọc 6 ô như Orders */
        .filter-grid{
            display:grid; grid-template-columns:repeat(6,1fr);
            gap:.75rem; align-items:stretch; margin-bottom:1rem;
        }
        .filter-grid .cell > *{
            height:48px; width:100%; border-radius:10px;
            font-size:.95rem; display:flex; align-items:center; justify-content:center;
        }
        .filter-grid .btn{ font-weight:700; }

        @media (max-width: 992px){ .filter-grid{ grid-template-columns:repeat(3,1fr); } }
        @media (max-width: 576px){ .filter-grid{ grid-template-columns:repeat(2,1fr); } }
    </style>
</head>
<body>
<section layout:fragment="content">
    <div class="alert alert-warning" sec:authorize="!hasAnyAuthority('DISCOUNT_VIEW','ROLE_ADMIN')">
        Bạn không có quyền xem danh sách giảm giá.
    </div>

    <div sec:authorize="hasAnyAuthority('DISCOUNT_VIEW','ROLE_ADMIN')">
        <h1 class="page-title mb-3 fw-bold">Danh sách giảm giá</h1>

        <form method="get" th:action="@{/admin/discounts}" class="filter-grid">
            <div class="cell">
                <input class="form-control" type="text" name="q" th:value="${q}" placeholder=" Tìm mã hoặc JSON...">
            </div>
            <div class="cell">
                <select class="form-select" name="type">
                    <option value="">Loại</option>
                    <option value="CODE" th:selected="${type == 'CODE'}">CODE</option>
                    <option value="AUTO" th:selected="${type == 'AUTO'}">AUTO</option>
                </select>
            </div>
            <div class="cell">
                <select class="form-select" name="valueType">
                    <option value="">Loại giảm giá</option>
                    <option value="FIXED" th:selected="${valueType == 'FIXED'}">FIXED</option>
                    <option value="PERCENT" th:selected="${valueType == 'PERCENT'}">PERCENT</option>
                </select>
            </div>
            <div class="cell">
                <button class="btn btn-primary w-100" type="submit">Tìm kiếm</button>
            </div>
            <div class="cell">
                <a class="btn btn-secondary w-100" th:href="@{/admin/discounts}">Đặt lại</a>
            </div>
            <div class="cell" sec:authorize="hasAnyAuthority('DISCOUNT_CREATE','ROLE_ADMIN')">
                <a th:href="@{/admin/discounts/new}" class="btn btn-create w-100">Thêm mã giảm giá</a>
            </div>
        </form>

        <div class="table-responsive">
            <table class="table table-hover align-middle w-100">
                <thead class="table-light">
                <tr>
                    <th>ID</th>
                    <th>Loại</th>
                    <th>Mã giảm</th>
                    <th>Loại giảm giá</th>
                    <th>Giá trị</th>
                    <th>Giá trị thấp nhất</th>
                    <th>Ngày áp dụng</th>
                    <th>Ngày hết hạn</th>
                    <th>Số lượng áp dụng</th>
                    <th>Số lượng đã dùng</th>
                    <th>Tình trạng</th>
                    <th>Thao tác</th>
                </tr>
                </thead>

                <tbody>
                <tr th:each="d : ${ (page != null and page.content != null) ? page.content : T(java.util.Collections).emptyList() }">
                    <td th:text="${d.id}">1</td>
                    <td th:text="${d.type}">CODE</td>
                    <td th:text="${d.code}">SALE10</td>

                    <td th:switch="${d.valueType != null ? d.valueType.name() : ''}">
                        <span class="badge bg-success" th:case="'FIXED'">💵 FIXED</span>
                        <span class="badge bg-primary" th:case="'PERCENT'">🎯 PERCENT</span>
                        <span class="badge bg-secondary" th:case="*">—</span>
                    </td>

                    <td th:switch="${d.valueType != null ? d.valueType.name() : ''}">
                        <span th:case="'FIXED'"
                              th:text="${#numbers.formatDecimal(d.valueAmount?:0, 0, 'COMMA', 0, 'POINT')} + ' ₫'">50,000 ₫</span>
                        <span th:case="'PERCENT'"
                              th:text="${#numbers.formatDecimal(d.valueAmount?:0, 0, 'COMMA', 0, 'POINT')} + ' %'">10 %</span>
                        <span th:case="*">—</span>
                    </td>

                    <td th:text="${#numbers.formatDecimal(d.minOrder?:0, 0, 'COMMA', 0, 'POINT')} + ' ₫'">0 ₫</td>

                    <td th:text="${d.startAt != null ? #temporals.format(d.startAt,'dd/MM/yyyy HH:mm') : ''}"></td>
                    <td th:text="${d.endAt != null ? #temporals.format(d.endAt,'dd/MM/yyyy HH:mm') : ''}"></td>

                    <td th:text="${d.usageLimit}">100</td>
                    <td th:text="${d.usedCount}">0</td>

                    <td th:switch="${d.status != null ? (d.status instanceof T(java.lang.Enum) ? d.status.name() : d.status) : ''}">
                        <span class="badge bg-success" th:case="'ACTIVE'">ACTIVE</span>
                        <span class="badge bg-secondary" th:case="*"
                              th:text="${d.status}">INACTIVE</span>
                    </td>

                    <td>
                        <div class="d-flex gap-2 justify-content-center">
                            <a th:href="@{|/admin/discounts/${d.id}/edit|}"
                               class="btn btn-action btn-edit"
                               sec:authorize="hasAnyAuthority('DISCOUNT_EDIT','ROLE_ADMIN')">Sửa</a>
                            <a th:href="@{|/admin/discounts/${d.id}/delete|}"
                               onclick="return confirm('Xoá discount này?');"
                               class="btn btn-action btn-delete"
                               sec:authorize="hasAnyAuthority('DISCOUNT_DELETE','ROLE_ADMIN')">Xóa</a>
                        </div>
                    </td>
                </tr>

                <tr th:if="${page == null || #lists.isEmpty(page.content)}">
                    <td colspan="12" class="text-center text-muted py-4">No data</td>
                </tr>
                </tbody>
            </table>
        </div>

        <div th:replace="~{layout/components/_pagination :: body(page=${page}, baseUrl='/admin/discounts', q=${q}, type=${type}, valueType=${valueType})}"></div>
    </div>
</section>
</body>
</html>
