<th:block th:fragment="productCard(product)">
  <div class="product-card"
       th:data-product-id="${product.slug}"
       th:data-product-slug="${product.slug}"
       th:data-product-title="${product.title}"
       th:data-product-price="${product.priceForCart}"
       th:data-product-image="${product.thumbnail != null ? product.thumbnail : '/images/product-placeholder.svg'}">

    <div class="thumb-wrap">
      <div class="thumb-ratio">
        <a class="product-link"
           th:href="@{/product/detail/{slug}(slug=${product.slug})}"
           th:aria-label="${product.title}">
          <img class="product-thumb"
               th:src="${product.thumbnail != null ? product.thumbnail : '/images/product-placeholder.svg'}"
               th:alt="${product.title}"
               loading="lazy"/>
        </a>
      </div>

      <!-- QUICK ADD -->
      <div class="quick-add"
           th:if="${product.sizes != null and !product.sizes.isEmpty()}"
           tabindex="0">
        <div class="quick-add__title">
          <span>Thêm vào giỏ hàng</span>
          <span class="quick-add__plus">+</span>
        </div>
        <div class="quick-add__sizes">
          <button class="quick-add__btn"
                  type="button"
                  th:each="size : ${product.sizes}"
                  th:text="${size}"
                  th:data-size="${size}"></button>
        </div>
      </div>
    </div>

    <!-- SWATCHES -->
    <div class="swatches" th:if="${product.colors != null and !product.colors.isEmpty()}">
      <button class="swatch"
              type="button"
              th:each="color, iterStat : ${product.colors}"
              th:classappend="${iterStat.first} ? ' is-active' : ''"
              th:data-color-name="${color['name']}"
              th:data-color="${color['name']}"
              th:data-color-hex="${color['hex']}"
              th:data-color-image="${color['image'] != null ? color['image'] : ''}"
              th:data-variant-id="${color['variantId']}"
              th:data-variant-price="${color['price']}"
              th:data-variant-compare="${color['compareAt']}"
              th:style="${color['style']}">
        <span class="visually-hidden" th:text="${color['name']}">Màu</span>
      </button>
    </div>

    <!-- INFO -->
    <div class="info">
      <a class="title"
         th:href="@{/product/detail/{slug}(slug=${product.slug})}"
         th:text="${product.title}">Sản phẩm</a>

      <div class="price-row">
        <span class="final"
              th:if="${product.finalPriceText != null}"
              th:text="${product.finalPriceText}">0&nbsp;₫</span>

        <span class="discount-pill"
              th:if="${product.hasDiscount and product.discountPercent > 0}"
              th:text="'-' + ${product.discountPercent} + '%'">-0%</span>

        <span class="old"
              th:if="${product.hasDiscount and product.originalPriceText != null}"
              th:text="${product.originalPriceText}">0&nbsp;₫</span>
      </div>
    </div>
  </div>
</th:block>
