<!--<!DOCTYPE html>-->
<!--<html lang="vi"-->
<!--      xmlns:th="http://www.thymeleaf.org"-->
<!--      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"-->
<!--      layout:decorate="~{layout/main}">-->
<!--<body>-->
<!--<section layout:fragment="content">-->
<!--    <h1 class="page-title">Adjust Inventory</h1>-->

<!--    &lt;!&ndash; Th√¥ng tin variant & t·ªìn kho hi·ªán t·∫°i &ndash;&gt;-->
<!--    <div class="card mb-3">-->
<!--        <div class="card-body">-->
<!--            <div><b>Variant:</b> <span th:text="${inv.variant?.sku}">SKU</span> ‚Äî <span th:text="${inv.variant?.product?.name}">Product</span></div>-->
<!--            <div><b>Color/Size:</b> <span th:text="${inv.variant?.color}">-</span> / <span th:text="${inv.variant?.size}">-</span></div>-->
<!--            <div class="mt-2 d-flex gap-2 flex-wrap">-->
<!--                <span class="badge bg-primary">On hand: <span th:text="${inv.qtyOnHand}">0</span></span>-->
<!--                <span class="badge bg-secondary">Reserved: <span th:text="${inv.qtyReserved}">0</span></span>-->
<!--                <span class="badge bg-success">Available: <span th:text="${inv.qtyOnHand - inv.qtyReserved}">0</span></span>-->
<!--            </div>-->
<!--        </div>-->
<!--    </div>-->

<!--    &lt;!&ndash; Form ƒëi·ªÅu ch·ªânh &ndash;&gt;-->
<!--    <form method="post"-->
<!--          th:action="@{|/admin/inventory/adjust/${inv.variantId}|}"-->
<!--          th:object="${form}"-->
<!--          class="vstack gap-3">-->

<!--        &lt;!&ndash; CSRF (n·∫øu d√πng Spring Security) &ndash;&gt;-->
<!--        <input type="hidden" th:name="${_csrf?.parameterName}" th:value="${_csrf?.token}"/>-->

<!--        &lt;!&ndash; Gi·ªØ l·∫°i variantId n·∫øu mu·ªën server l·∫•y qua request param trong tr∆∞·ªùng h·ª£p b·∫°n chuy·ªÉn sang POST /adjust &ndash;&gt;-->
<!--        <input type="hidden" name="variantId" th:value="${inv.variantId}"/>-->

<!--        <div class="row g-3">-->
<!--            <div class="col-md-3">-->
<!--                <label class="form-label">Delta (¬±)</label>-->
<!--                <input class="form-control" type="number" th:field="*{delta}" placeholder="+10 nh·∫≠p kho, -5 h·ªßy h√†ng" required>-->
<!--                <div class="form-text">Nh·∫≠p s·ªë d∆∞∆°ng ƒë·ªÉ c·ªông, √¢m ƒë·ªÉ tr·ª´.</div>-->
<!--            </div>-->

<!--            <div class="col-md-3">-->
<!--                <label class="form-label">Ref type</label>-->
<!--                <select class="form-select" th:field="*{refType}" required>-->
<!--                    &lt;!&ndash; bind theo name() ƒë·ªÉ Spring EnumConverter map ch·∫Øc ch·∫Øn &ndash;&gt;-->
<!--                    <option value="" disabled th:selected="${form.refType} == null">&#45;&#45; Ch·ªçn &#45;&#45;</option>-->
<!--                    <option th:each="rt : ${refTypes}"-->
<!--                            th:value="${rt.name()}"-->
<!--                            th:text="${rt}">-->
<!--                    </option>-->
<!--                </select>-->
<!--            </div>-->

<!--            <div class="col-md-3">-->
<!--                <label class="form-label">Ref ID</label>-->
<!--                <input class="form-control" type="number" th:field="*{refId}" placeholder="VD: ID phi·∫øu nh·∫≠p, phi·∫øu xu·∫•t">-->
<!--            </div>-->

<!--            <div class="col-md-3">-->
<!--                <label class="form-label">User ID</label>-->
<!--                <input class="form-control" type="number" th:field="*{userId}" placeholder="Ng∆∞·ªùi thao t√°c (optional)">-->
<!--            </div>-->
<!--        </div>-->

<!--        <div>-->
<!--            <label class="form-label">Note</label>-->
<!--            <input class="form-control" th:field="*{note}" placeholder="L√Ω do ƒëi·ªÅu ch·ªânh (v√≠ d·ª•: ki·ªÉm k√™, h·ªßy h√†ng, nh·∫≠p kho)">-->
<!--        </div>-->

<!--        <div class="d-flex gap-2">-->
<!--            <button class="btn btn-primary" type="submit">Apply</button>-->
<!--            <a class="btn btn-secondary" th:href="@{/admin/inventory}">Back</a>-->
<!--        </div>-->
<!--    </form>-->

<!--    &lt;!&ndash; Xem tr∆∞·ªõc Available sau khi √°p d·ª•ng (client-side) &ndash;&gt;-->
<!--    <div class="mt-3 text-muted">-->
<!--        <small>-->
<!--            D·ª± ki·∫øn Available sau ƒëi·ªÅu ch·ªânh:-->
<!--            <span id="previewAvail"-->
<!--                  th:data-onhand="${inv.qtyOnHand}"-->
<!--                  th:data-reserved="${inv.qtyReserved}">‚Äî</span>-->
<!--        </small>-->
<!--    </div>-->

<!--    <script th:inline="javascript">-->
<!--        // Preview Available = (onHand + delta) - reserved-->
<!--        (function () {-->
<!--            const deltaInput = document.querySelector('[name="delta"]');-->
<!--            const prev = document.getElementById('previewAvail');-->
<!--            if (!deltaInput || !prev) return;-->

<!--            const onHand = Number(prev.dataset.onhand || 0);-->
<!--            const reserved = Number(prev.dataset.reserved || 0);-->

<!--            function render() {-->
<!--                const d = Number(deltaInput.value || 0);-->
<!--                const avail = (onHand + d) - reserved;-->
<!--                prev.textContent = isNaN(avail) ? '‚Äî' : String(avail);-->
<!--            }-->
<!--            deltaInput.addEventListener('input', render);-->
<!--            render();-->
<!--        })();-->
<!--    </script>-->
<!--</section>-->
<!--</body>-->
<!--</html>-->

<!DOCTYPE html>
<html lang="vi"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/main}">
<head>
    <meta charset="UTF-8">
    <title th:text="${inv.variantId != null} ? 'ƒêi·ªÅu ch·ªânh T·ªìn kho #' + ${inv.variantId} : 'ƒêi·ªÅu ch·ªânh T·ªìn kho'"></title>
    <style>
        :root{
            --bg:#f8fafc;
            --surface:#ffffff;
            --text:#0f172a;
            --muted:#64748b;
            --bd:#e2e8f0;
            --ring:#93c5fd;
            --primary:#2563eb;
            --primary-hover:#1d4ed8;
            --danger:#ef4444;
            --danger-hover:#dc2626;
            --success:#22c55e;
            --secondary:#475569;
        }

        body{font-family:"Inter",system-ui,sans-serif;background:var(--bg);color:var(--text);}

        .wrap{max-width:900px;margin:0 auto;padding:40px 0;}
        .page-title{text-align:center;font-size:1.9rem;font-weight:800;color:var(--text);margin-bottom:30px;}

        .card{
            background:var(--surface);border:1px solid var(--bd);border-radius:1rem;
            box-shadow:0 2px 4px rgba(15,23,42,.05);padding:24px 32px;margin-bottom:24px;
        }

        /* Th√¥ng tin s·∫£n ph·∫©m */
        .info-header{font-size:1.1rem;font-weight:600;color:var(--text);margin-bottom:6px;}
        .info-sub{color:var(--muted);font-size:.9rem;margin-bottom:14px;}

        /* Badges chia ƒë·ªÅu 3 ph·∫ßn */
        .badges{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:12px;}
        @media(max-width:720px){.badges{grid-template-columns:1fr;}}
        .badge{
            display:flex;align-items:center;justify-content:center;
            padding:.8rem 1rem;border-radius:.8rem;font-weight:700;font-size:1rem;
        }
        .bg-primary{background:var(--primary);color:#fff;}
        .bg-secondary{background:var(--secondary);color:#fff;}
        .bg-success{background:var(--success);color:#fff;}

        /* Form */
        .form-grid{display:grid;gap:20px;margin-bottom:24px;}
        .row-top{grid-template-columns:repeat(2,minmax(0,1fr));}
        .row-bottom{grid-template-columns:repeat(2,minmax(0,1fr));}
        @media(max-width:720px){.row-top,.row-bottom{grid-template-columns:1fr;}}

        .form-label{display:block;font-weight:600;font-size:.9rem;color:var(--text);margin-bottom:.35rem;}
        .field{
            width:100%;border:1px solid var(--bd);border-radius:.75rem;padding:.7rem .9rem;
            font-size:.95rem;color:var(--text);background:var(--surface);transition:.2s ease;
        }
        .field:focus{outline:none;border-color:var(--primary);box-shadow:0 0 0 3px var(--ring);}
        .form-text{font-size:.8rem;color:var(--muted);margin-top:.25rem;}

        /* Actions */
        .form-actions{
            display:flex;align-items:center;justify-content:flex-end;gap:14px;margin-top:30px;
        }
        .btn{
            display:inline-flex;align-items:center;justify-content:center;border-radius:.75rem;
            padding:.75rem 1.25rem;font-weight:600;cursor:pointer;transition:.2s ease;font-size:.95rem;
            border:1px solid transparent;
        }
        .btn-primary{background:var(--primary);color:#fff;}
        .btn-primary:hover{background:var(--primary-hover);}
        .btn-danger{background:var(--danger);color:#fff;}
        .btn-danger:hover{background:var(--danger-hover);}

        .preview{margin-top:20px;font-size:.9rem;color:var(--muted);}
        .preview span{font-weight:700;color:var(--text);}
    </style>
</head>
<body>
<section layout:fragment="content">
    <div class="wrap">
        <h1 class="page-title">üßæ ƒêi·ªÅu ch·ªânh T·ªìn kho</h1>

        <!-- Th√¥ng tin s·∫£n ph·∫©m -->
        <div class="card">
            <div class="info-header">
                <span th:text="${inv.variant?.sku}">TSK-BLK-S</span> ‚Äî
                <span th:text="${inv.variant?.product?.name}">S·∫£n ph·∫©m m·∫´u chung</span>
            </div>
            <div class="info-sub">
                <b>M√†u/K√≠ch c·ª°:</b>
                <span th:text="${inv.variant?.color}">ƒêen</span> /
                <span th:text="${inv.variant?.size}">S</span>
            </div>
            <div class="badges">
                <div class="badge bg-primary">T·ªìn kho (On hand): <span style="margin-left:.35rem" th:text="${inv.qtyOnHand}">45</span></div>
                <div class="badge bg-secondary">ƒê√£ gi·ªØ (Reserved): <span style="margin-left:.35rem" th:text="${inv.qtyReserved}">40</span></div>
                <div class="badge bg-success">Kh·∫£ d·ª•ng (Available): <span style="margin-left:.35rem" th:text="${inv.qtyOnHand - inv.qtyReserved}">5</span></div>
            </div>
        </div>

        <!-- Form -->
        <div class="card">
            <form method="post"
                  th:action="@{|/admin/inventory/adjust/${inv.variantId}|}"
                  th:object="${form}">
                <input type="hidden" th:name="${_csrf?.parameterName}" th:value="${_csrf?.token}"/>
                <input type="hidden" name="variantId" th:value="${inv.variantId}"/>

                <!-- H√†ng 1 -->
                <div class="form-grid row-top">
                    <div>
                        <label class="form-label">Delta (¬±) *</label>
                        <input class="field" type="number" th:field="*{delta}" placeholder="+10 nh·∫≠p kho, -5 h·ªßy h√†ng" required>
                        <div class="form-text">Nh·∫≠p s·ªë d∆∞∆°ng ƒë·ªÉ c·ªông, √¢m ƒë·ªÉ tr·ª´.</div>
                    </div>
                    <div>
                        <label class="form-label">ID Ng∆∞·ªùi thao t√°c (T√πy ch·ªçn)</label>
                        <input class="field" type="number" th:field="*{userId}" placeholder="Ng∆∞·ªùi thao t√°c (optional)">
                    </div>
                </div>

                <!-- H√†ng 2 -->
                <div class="form-grid row-bottom">
                    <div>
                        <label class="form-label">Lo·∫°i Tham chi·∫øu</label>
                        <select class="field" th:field="*{refType}" required>
                            <option value="" disabled th:selected="${form.refType} == null">-- Ch·ªçn --</option>
                            <option th:each="rt : ${refTypes}" th:value="${rt.name()}" th:text="${rt}"></option>
                        </select>
                    </div>
                    <div>
                        <label class="form-label">M√£ Tham chi·∫øu (ID)</label>
                        <input class="field" type="number" th:field="*{refId}" placeholder="VD: ID phi·∫øu nh·∫≠p, phi·∫øu xu·∫•t">
                    </div>
                </div>

                <!-- Ghi ch√∫ -->
                <div>
                    <label class="form-label">Ghi ch√∫ / L√Ω do ƒëi·ªÅu ch·ªânh</label>
                    <input class="field" th:field="*{note}" placeholder="L√Ω do ƒëi·ªÅu ch·ªânh (v√≠ d·ª•: ki·ªÉm k√™, h·ªßy h√†ng, nh·∫≠p kho)">
                </div>

                <!-- Actions (cƒÉn ph·∫£i + ƒë·ªïi v·ªã tr√≠) -->
                <div class="form-actions">
                    <a class="btn btn-danger" th:href="@{/admin/inventory}">‚Üê Quay l·∫°i</a>
                    <button class="btn btn-primary" type="submit">‚úÖ √Åp d·ª•ng ƒëi·ªÅu ch·ªânh</button>
                </div>

                <div class="preview">
                    D·ª± ki·∫øn Kh·∫£ d·ª•ng sau ƒëi·ªÅu ch·ªânh:
                    <span id="previewAvail"
                          th:data-onhand="${inv.qtyOnHand}"
                          th:data-reserved="${inv.qtyReserved}">‚Äî</span>
                </div>
            </form>
        </div>
    </div>

    <script th:inline="javascript">
        (function () {
            const deltaInput = document.querySelector('[name="delta"]');
            const prev = document.getElementById('previewAvail');
            if (!deltaInput || !prev) return;
            const onHand = Number(prev.dataset.onhand || 0);
            const reserved = Number(prev.dataset.reserved || 0);
            function render() {
                const d = Number(deltaInput.value || 0);
                const avail = (onHand + d) - reserved;
                prev.textContent = isNaN(avail) ? '‚Äî' : Math.round(avail);
            }
            deltaInput.addEventListener('input', render);
            render();
        })();
    </script>
</section>
</body>
</html>
